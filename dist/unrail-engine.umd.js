var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(t,e,i)=>e in t?__defProp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,__spreadValues=(t,e)=>{for(var i in e||(e={}))__hasOwnProp.call(e,i)&&__defNormalProp(t,i,e[i]);if(__getOwnPropSymbols)for(var i of __getOwnPropSymbols(e))__propIsEnum.call(e,i)&&__defNormalProp(t,i,e[i]);return t},__spreadProps=(t,e)=>__defProps(t,__getOwnPropDescs(e));!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["unrail-engine"]={})}(this,(function(t){"use strict";"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;class e{static random(){return Math.random()}static randint(t,e){return Math.floor(t+Math.random()*(e-t))}static choice(t){return t[~~(e.random()*t.length)]}static bool(){return e.random()>.5}static sign(){return e.choice([-1,1])}static percent(t){return e.random()<t/100}}var i=e;class s{constructor(t,e){this.x=t,this.y=e}clone(){return new s(this.x,this.y)}add(t){return new s(this.x+t.x,this.y+t.y)}multiply(t){return new s(this.x*t,this.y*t)}dot(t){return this.x*t.x+this.y*t.y}dist(t){return Math.sqrt((this.x-t.x)**2+(this.y-t.y)**2)}}const n=s,a=new s(0,0),o=new s(1,1);function l(t,e,i){return Math.max(t,Math.min(e,i))}function r(t,e,i){return l(e,t,i)===t}function c(){return{width:window.innerWidth,height:window.innerHeight}}function d(t){return{width:t.clientWidth||t.width,height:t.clientHeight||t.height}}function h(t,e,i,s){const n=document.createElement("canvas");return u(n,t,e,i),s&&(n.oncontextmenu=t=>t.preventDefault()),n}function u(t,e,i,s){const n=s||window.devicePixelRatio||1;let a=e||d(t).width,o=i||d(t).height;t.width=a*n,t.height=o*n,t.style.width=a+"px",t.style.height=o+"px",1!=n&&t.getContext("2d").setTransform(n,0,0,n,0,0)}function p(t,e){window.addEventListener("DOMContentLoaded",(()=>{var i;const s=null!=(i=document.querySelector(e))?i:document.createElement(e);s.appendChild(t),document.querySelector("body").appendChild(s)}))}function m(){return null==self.document&&null==self.window}function b(){return performance.now()||Date.now()}function y(t){return window&&t in window}var x,f;(f=x||(x={}))[f.KeyboardPressed=0]="KeyboardPressed",f[f.KeyboardDown=1]="KeyboardDown",f[f.Mouse=2]="Mouse",f[f.Window=3]="Window",f[f.Custom=4]="Custom",f[f.All=5]="All";class Z{constructor(t,e,i=4){this.name=t,this.callback=e,this.type=i,this.listeners=[this.callback]}static emit(t,e){const i=g.getCustomEvent(t);i&&i.listeners.forEach((t=>t(e)))}static on(t,e){const i=g.getCustomEvent(t);if(i)i.listeners.push(e);else{const i=new Z(t,e,4);g.addEvent(i)}}static onKeyDown(t,e){g.addEvent(new Z(t,e,1))}static onKeyPressed(t,e){g.addEvent(new Z(t,e,0))}static onClick(t){Z.onMouseClick(t)}static onMouseClick(t){g.addEvent(new Z("click",t,2))}static onMouseMove(t){g.addEvent(new Z("mousemove",t,2))}}const g=new class{constructor(){this.windowEvents=[],this.customEvents=[],this.mouseEvents=[],this.keyboardDownEvents=[],this.keyboardPressedEvents=[],this.currentKeyEvents=[]}init(){window.addEventListener("keydown",(t=>{this.currentKeyEvents.find((e=>e.code===t.code))||this.currentKeyEvents.push(t),this.keyboardPressedEvents.forEach((e=>{t.code===e.name&&e.callback(t)}))})),window.addEventListener("keyup",(t=>{this.currentKeyEvents.length&&(this.currentKeyEvents=this.currentKeyEvents.filter((e=>e.code!==t.code)))})),this.bindEvents()}addEvent(t){switch(t.type){case x.KeyboardDown:this.keyboardDownEvents.push(t);break;case x.KeyboardPressed:this.keyboardPressedEvents.push(t);break;case x.Mouse:this.mouseEvents.push(t),window.addEventListener(t.name,(e=>t.callback(e)));break;case x.Window:this.windowEvents.push(t),this.bindEvents();break;case x.Custom:this.customEvents.push(t)}}getCustomEvent(t){return this.customEvents.find((e=>e.name===t))}bindEvents(){this.windowEvents.forEach((t=>window.addEventListener(t.name,t.callback)))}tick(){this.currentKeyEvents.length&&this.keyboardDownEvents.forEach((t=>{this.currentKeyEvents.forEach((e=>{e.code===t.name&&t.callback(e)}))}))}};const w=new class{constructor(){this.hasStarted=!1,this.animations=[]}add(t){this.animations.push(t),this.hasStarted&&t.options.autostart&&t.start()}init(){this.hasStarted=!0;for(let t of this.animations)t.options.autostart&&t.start()}tick(t){for(let e of this.animations)e.update(t)}};var G,L={exports:{}};L.exports=((G=function(){function t(t){return s.appendChild(t.dom),t}function e(t){for(var e=0;e<s.children.length;e++)s.children[e].style.display=e===t?"block":"none";i=t}var i=0,s=document.createElement("div");s.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",s.addEventListener("click",(function(t){t.preventDefault(),e(++i%s.children.length)}),!1);var n=(performance||Date).now(),a=n,o=0,l=t(new G.Panel("FPS","#0ff","#002")),r=t(new G.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new G.Panel("MB","#f08","#201"));return e(0),{REVISION:16,dom:s,addPanel:t,showPanel:e,begin:function(){n=(performance||Date).now()},end:function(){o++;var t=(performance||Date).now();if(r.update(t-n,200),t>a+1e3&&(l.update(1e3*o/(t-a),100),a=t,o=0,c)){var e=performance.memory;c.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){n=this.end()},domElement:s,setMode:e}}).Panel=function(t,e,i){var s=1/0,n=0,a=Math.round,o=a(window.devicePixelRatio||1),l=80*o,r=48*o,c=3*o,d=2*o,h=3*o,u=15*o,p=74*o,m=30*o,b=document.createElement("canvas");b.width=l,b.height=r,b.style.cssText="width:80px;height:48px";var y=b.getContext("2d");return y.font="bold "+9*o+"px Helvetica,Arial,sans-serif",y.textBaseline="top",y.fillStyle=i,y.fillRect(0,0,l,r),y.fillStyle=e,y.fillText(t,c,d),y.fillRect(h,u,p,m),y.fillStyle=i,y.globalAlpha=.9,y.fillRect(h,u,p,m),{dom:b,update:function(r,x){s=Math.min(s,r),n=Math.max(n,r),y.fillStyle=i,y.globalAlpha=1,y.fillRect(0,0,l,u),y.fillStyle=e,y.fillText(a(r)+" "+t+" ("+a(s)+"-"+a(n)+")",c,d),y.drawImage(b,h+o,u,p-o,m,h,u,p-o,m),y.fillRect(h+p-o,u,o,m),y.fillStyle=i,y.globalAlpha=.9,y.fillRect(h+p-o,u,o,a((1-r/x)*m))}}},G);var R=L.exports;String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};class S extends Error{constructor(t,e){super(e?`[${e.capitalize()}] - ${t}`:t),this.name="EngineFailure"}}class v extends S{constructor(t){super(t,"renderer")}}const W={strokeStyle:"black",lineWidth:2,lineJoin:"round",lineCap:"round",fillStyle:"transparent",globalAlpha:1,globalCompositeOperation:"add"},C={font:"Roboto",size:16,color:"black"},X=2*Math.PI;let Y,k,K,H,I,V=m()?4:2*(window.devicePixelRatio||1);function N(t){return~~(t*V)/V}class J{static create(t,e){let[i,s]=[c().width,c().height];const n=h(t||i,e||s);return p(n,"main"),J.setContext(n.getContext("2d")),n}static createFromCanvas(t){let e=document.querySelector(t);if(!(e&&e instanceof HTMLCanvasElement))throw new v("The selected element is not a canvas");return u(e),J.setContext(e.getContext("2d")),e}static setContext(t){Y=t}static getContext(){return Y}static style(t){if(!Y)throw new v("Context has not been initialize. Please use Renderer.setContext");const e=__spreadValues(__spreadValues({},W),t);if(e!==k){for(let t in e)Y[t]!==e[t]&&(Y[t]=e[t]);k=e}}static clear(t){t?(J.style({fillStyle:t}),Y.fillRect(0,0,Y.canvas.width,Y.canvas.height)):Y.clearRect(0,0,Y.canvas.width,Y.canvas.height)}static line(t,e,i,s,n){J.style(n),Y.beginPath(),Y.moveTo(N(t),N(e)),Y.lineTo(N(i),N(s)),Y.stroke()}static rect(t,e,i,s,n){J.style(n);const[a,o,l,r]=[N(t),N(e),N(i),N(s)];Y.fillRect(a,o,l,r),Y.strokeRect(a,o,l,r)}static rectFromCenter(t,e,i,s,n){return J.rect(t-i/2,e-s/2,i,s,n)}static rectFromPoints(t,e,i,s,n){return J.rect(t,e,i-t,s-e,n)}static poly(t,e){if(t.length){J.style(e),Y.beginPath(),Y.moveTo(N(t[0].x),N(t[0].y));for(let e=1;e<t.length;e++)Y.lineTo(N(t[e].x),N(t[e].y));Y.stroke()}}static circle(t,e,i,s){J.style(s),Y.beginPath(),Y.arc(N(t),N(e),i,0,X),Y.fill(),Y.stroke()}static circleFromRect(t,e,i,s,n){return J.circle(t+i/2,e+s/2,Math.min(i,s)/2,n)}static point(t,e,i){J.circle(t,e,5,i)}static rectSprite(t,e,i,s,n){J.style({}),Y.save(),Y.translate(N(t+i/2),N(e+s/2)),Y.scale(n.scale.x,n.scale.y),Y.rotate(n.rotation),Y.drawImage(n.image,N(i*n.offset.x-i/2),N(s*n.offset.y-s/2),N(i),N(s)),Y.restore()}static circleSprite(t,e,i,s){Y.save(),Y.beginPath(),Y.arc(N(t),N(e),i,0,X),Y.clip(),J.rectSprite(t-i,e-i,2*i,2*i,s),Y.restore()}static text(t,e,i,s){if(Y){let t=__spreadValues(__spreadValues({},C),s);Y.font=`${t.size}px ${t.font}`,J.style({fillStyle:t.color})}Y.fillText(t,e,i)}static tint(t,e,i,s,n){J.rect(e,i,s,n,{fillStyle:t,globalCompositeOperation:"multiply",globalAlpha:.25})}static beginFrame(t){J.clear(t)}static endFrame(){}}class E{constructor(t,e){this.title=t,this.content=e}}class U{constructor(t,e){this.methodName=t,this.args=e}}function F(){return new Worker("data:application/javascript;base64,dmFyIGU9T2JqZWN0LmRlZmluZVByb3BlcnR5LHQ9T2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyxpPU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkscj1PYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlLG49KHQsaSxyKT0+aSBpbiB0P2UodCxpLHtlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMCx3cml0YWJsZTohMCx2YWx1ZTpyfSk6dFtpXT1yLHM9KGUscyk9Pntmb3IodmFyIGEgaW4gc3x8KHM9e30pKWkuY2FsbChzLGEpJiZuKGUsYSxzW2FdKTtpZih0KWZvcih2YXIgYSBvZiB0KHMpKXIuY2FsbChzLGEpJiZuKGUsYSxzW2FdKTtyZXR1cm4gZX07ZnVuY3Rpb24gYSgpe3JldHVybnt3aWR0aDp3aW5kb3cuaW5uZXJXaWR0aCxoZWlnaHQ6d2luZG93LmlubmVySGVpZ2h0fX1mdW5jdGlvbiBjKGUpe3JldHVybnt3aWR0aDplLmNsaWVudFdpZHRofHxlLndpZHRoLGhlaWdodDplLmNsaWVudEhlaWdodHx8ZS5oZWlnaHR9fWZ1bmN0aW9uIG8oZSx0LGkscil7Y29uc3Qgbj1yfHx3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpb3x8MTtsZXQgcz10fHxjKGUpLndpZHRoLGE9aXx8YyhlKS5oZWlnaHQ7ZS53aWR0aD1zKm4sZS5oZWlnaHQ9YSpuLGUuc3R5bGUud2lkdGg9cysicHgiLGUuc3R5bGUuaGVpZ2h0PWErInB4IiwxIT1uJiZlLmdldENvbnRleHQoIjJkIikuc2V0VHJhbnNmb3JtKG4sMCwwLG4sMCwwKX1TdHJpbmcucHJvdG90eXBlLmNhcGl0YWxpemU9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSt0aGlzLnNsaWNlKDEpfTtjbGFzcyBsIGV4dGVuZHMgRXJyb3J7Y29uc3RydWN0b3IoZSx0KXtzdXBlcih0P2BbJHt0LmNhcGl0YWxpemUoKX1dIC0gJHtlfWA6ZSksdGhpcy5uYW1lPSJFbmdpbmVGYWlsdXJlIn19Y2xhc3MgaCBleHRlbmRzIGx7Y29uc3RydWN0b3IoZSl7c3VwZXIoZSwicmVuZGVyZXIiKX19Y29uc3QgZD17c3Ryb2tlU3R5bGU6ImJsYWNrIixsaW5lV2lkdGg6MixsaW5lSm9pbjoicm91bmQiLGxpbmVDYXA6InJvdW5kIixmaWxsU3R5bGU6InRyYW5zcGFyZW50IixnbG9iYWxBbHBoYToxLGdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbjoiYWRkIn0sdT17Zm9udDoiUm9ib3RvIixzaXplOjE2LGNvbG9yOiJibGFjayJ9LGY9MipNYXRoLlBJO2xldCB4LGcscD1udWxsPT1zZWxmLmRvY3VtZW50JiZudWxsPT1zZWxmLndpbmRvdz80OjIqKHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvfHwxKTtmdW5jdGlvbiB5KGUpe3JldHVybn5+KGUqcCkvcH1jbGFzcyBie3N0YXRpYyBjcmVhdGUoZSx0KXtsZXRbaSxyXT1bYSgpLndpZHRoLGEoKS5oZWlnaHRdO2NvbnN0IG49ZnVuY3Rpb24oZSx0LGkscil7Y29uc3Qgbj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJjYW52YXMiKTtyZXR1cm4gbyhuLGUsdCxpKSxyJiYobi5vbmNvbnRleHRtZW51PWU9PmUucHJldmVudERlZmF1bHQoKSksbn0oZXx8aSx0fHxyKTtyZXR1cm4gZnVuY3Rpb24oZSx0KXt3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsKCgpPT57dmFyIGk7Y29uc3Qgcj1udWxsIT0oaT1kb2N1bWVudC5xdWVyeVNlbGVjdG9yKHQpKT9pOmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodCk7ci5hcHBlbmRDaGlsZChlKSxkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJib2R5IikuYXBwZW5kQ2hpbGQocil9KSl9KG4sIm1haW4iKSxiLnNldENvbnRleHQobi5nZXRDb250ZXh0KCIyZCIpKSxufXN0YXRpYyBjcmVhdGVGcm9tQ2FudmFzKGUpe2xldCB0PWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZSk7aWYoISh0JiZ0IGluc3RhbmNlb2YgSFRNTENhbnZhc0VsZW1lbnQpKXRocm93IG5ldyBoKCJUaGUgc2VsZWN0ZWQgZWxlbWVudCBpcyBub3QgYSBjYW52YXMiKTtyZXR1cm4gbyh0KSxiLnNldENvbnRleHQodC5nZXRDb250ZXh0KCIyZCIpKSx0fXN0YXRpYyBzZXRDb250ZXh0KGUpe3g9ZX1zdGF0aWMgZ2V0Q29udGV4dCgpe3JldHVybiB4fXN0YXRpYyBzdHlsZShlKXtpZigheCl0aHJvdyBuZXcgaCgiQ29udGV4dCBoYXMgbm90IGJlZW4gaW5pdGlhbGl6ZS4gUGxlYXNlIHVzZSBSZW5kZXJlci5zZXRDb250ZXh0Iik7Y29uc3QgdD1zKHMoe30sZCksZSk7aWYodCE9PWcpe2ZvcihsZXQgZSBpbiB0KXhbZV0hPT10W2VdJiYoeFtlXT10W2VdKTtnPXR9fXN0YXRpYyBjbGVhcihlKXtlPyhiLnN0eWxlKHtmaWxsU3R5bGU6ZX0pLHguZmlsbFJlY3QoMCwwLHguY2FudmFzLndpZHRoLHguY2FudmFzLmhlaWdodCkpOnguY2xlYXJSZWN0KDAsMCx4LmNhbnZhcy53aWR0aCx4LmNhbnZhcy5oZWlnaHQpfXN0YXRpYyBsaW5lKGUsdCxpLHIsbil7Yi5zdHlsZShuKSx4LmJlZ2luUGF0aCgpLHgubW92ZVRvKHkoZSkseSh0KSkseC5saW5lVG8oeShpKSx5KHIpKSx4LnN0cm9rZSgpfXN0YXRpYyByZWN0KGUsdCxpLHIsbil7Yi5zdHlsZShuKTtjb25zdFtzLGEsYyxvXT1beShlKSx5KHQpLHkoaSkseShyKV07eC5maWxsUmVjdChzLGEsYyxvKSx4LnN0cm9rZVJlY3QocyxhLGMsbyl9c3RhdGljIHJlY3RGcm9tQ2VudGVyKGUsdCxpLHIsbil7cmV0dXJuIGIucmVjdChlLWkvMix0LXIvMixpLHIsbil9c3RhdGljIHJlY3RGcm9tUG9pbnRzKGUsdCxpLHIsbil7cmV0dXJuIGIucmVjdChlLHQsaS1lLHItdCxuKX1zdGF0aWMgcG9seShlLHQpe2lmKGUubGVuZ3RoKXtiLnN0eWxlKHQpLHguYmVnaW5QYXRoKCkseC5tb3ZlVG8oeShlWzBdLngpLHkoZVswXS55KSk7Zm9yKGxldCB0PTE7dDxlLmxlbmd0aDt0KyspeC5saW5lVG8oeShlW3RdLngpLHkoZVt0XS55KSk7eC5zdHJva2UoKX19c3RhdGljIGNpcmNsZShlLHQsaSxyKXtiLnN0eWxlKHIpLHguYmVnaW5QYXRoKCkseC5hcmMoeShlKSx5KHQpLGksMCxmKSx4LmZpbGwoKSx4LnN0cm9rZSgpfXN0YXRpYyBjaXJjbGVGcm9tUmVjdChlLHQsaSxyLG4pe3JldHVybiBiLmNpcmNsZShlK2kvMix0K3IvMixNYXRoLm1pbihpLHIpLzIsbil9c3RhdGljIHBvaW50KGUsdCxpKXtiLmNpcmNsZShlLHQsNSxpKX1zdGF0aWMgcmVjdFNwcml0ZShlLHQsaSxyLG4pe2Iuc3R5bGUoe30pLHguc2F2ZSgpLHgudHJhbnNsYXRlKHkoZStpLzIpLHkodCtyLzIpKSx4LnNjYWxlKG4uc2NhbGUueCxuLnNjYWxlLnkpLHgucm90YXRlKG4ucm90YXRpb24pLHguZHJhd0ltYWdlKG4uaW1hZ2UseShpKm4ub2Zmc2V0LngtaS8yKSx5KHIqbi5vZmZzZXQueS1yLzIpLHkoaSkseShyKSkseC5yZXN0b3JlKCl9c3RhdGljIGNpcmNsZVNwcml0ZShlLHQsaSxyKXt4LnNhdmUoKSx4LmJlZ2luUGF0aCgpLHguYXJjKHkoZSkseSh0KSxpLDAsZikseC5jbGlwKCksYi5yZWN0U3ByaXRlKGUtaSx0LWksMippLDIqaSxyKSx4LnJlc3RvcmUoKX1zdGF0aWMgdGV4dChlLHQsaSxyKXtpZih4KXtsZXQgZT1zKHMoe30sdSkscik7eC5mb250PWAke2Uuc2l6ZX1weCAke2UuZm9udH1gLGIuc3R5bGUoe2ZpbGxTdHlsZTplLmNvbG9yfSl9eC5maWxsVGV4dChlLHQsaSl9c3RhdGljIHRpbnQoZSx0LGkscixuKXtiLnJlY3QodCxpLHIsbix7ZmlsbFN0eWxlOmUsZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uOiJtdWx0aXBseSIsZ2xvYmFsQWxwaGE6LjI1fSl9c3RhdGljIGJlZ2luRnJhbWUoZSl7Yi5jbGVhcihlKX1zdGF0aWMgZW5kRnJhbWUoKXt9fW5ldyBjbGFzcyBleHRlbmRzIGNsYXNze3NlbmRNZXNzYWdlVG9NYWluVGhyZWFkKGUsdCl7c2VsZi5wb3N0TWVzc2FnZSh7dGl0bGU6ZSxkYXRhOnR9KX1sb2coLi4uZSl7dGhpcy5zZW5kTWVzc2FnZVRvTWFpblRocmVhZCgibG9nIiwuLi5lKX19e2NvbnN0cnVjdG9yKCl7c3VwZXIoKSx0aGlzLmNhbnZhc1Jlc29sdXRpb249MSx0aGlzLm9mZnNjcmVlbkNhbnZhcz1udWxsLHRoaXMuY3R4PW51bGwsdGhpcy50ZXh0dXJlQWxpYXM9bmV3IE1hcCxzZWxmLmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCgoe2RhdGE6ZX0pPT50aGlzLm9uTWVzc2FnZShlLnRpdGxlLGUuY29udGVudCkpKX1vbk1lc3NhZ2UoZSx0KXtzd2l0Y2goZSl7Y2FzZSJpbml0Q2FudmFzIjp0aGlzLm9mZnNjcmVlbkNhbnZhcz10LmNhbnZhcyx0aGlzLmN0eD10aGlzLm9mZnNjcmVlbkNhbnZhcy5nZXRDb250ZXh0KCIyZCIpLGIuc2V0Q29udGV4dCh0aGlzLmN0eCksdGhpcy5zZXRTaXplKHQuZHByLHQud2lkdGgsdC5oZWlnaHQpLHRoaXMuc2VuZE1lc3NhZ2VUb01haW5UaHJlYWQoImluaXRpYWxpemVkIik7YnJlYWs7Y2FzZSJyZW5kZXIiOmZvcihsZXQgZSBvZiB0LnJlbmRlclN0YWNrKXRoaXMuaGFuZGxlRHJhd1JlcXVlc3QoZS5tZXRob2ROYW1lLGUuYXJncyk7YnJlYWs7Y2FzZSJuZXdUZXh0dXJlIjp0aGlzLnRleHR1cmVBbGlhc1t0LmlkXT10LnRleHR1cmV9fXNldFNpemUoZSx0LGkpe2NvbnN0IHI9KGV8fDEpKnRoaXMuY2FudmFzUmVzb2x1dGlvbjt0aGlzLm9mZnNjcmVlbkNhbnZhcy53aWR0aD10KnIsdGhpcy5vZmZzY3JlZW5DYW52YXMuaGVpZ2h0PWkqciwic2V0VHJhbnNmb3JtImluIHRoaXMuY3R4JiZ0aGlzLmN0eC5zZXRUcmFuc2Zvcm0ociwwLDAsciwwLDApfWdldFRleHR1cmUoZSl7cmV0dXJuIHRoaXMudGV4dHVyZUFsaWFzW2VdfWhhbmRsZURyYXdSZXF1ZXN0KGUsdCl7c3dpdGNoKGUpe2Nhc2Uic3R5bGUiOmIuc3R5bGUobnVsbD09dD92b2lkIDA6dC5vYmopO2JyZWFrO2Nhc2UiY2xlYXIiOmIuY2xlYXIobnVsbD09dD92b2lkIDA6dC5jb2xvcik7YnJlYWs7Y2FzZSJsaW5lIjpiLmxpbmUodC54MSx0LnkxLHQueDIsdC55Mix0Lm9iaik7YnJlYWs7Y2FzZSJyZWN0IjpiLnJlY3QodC54LHQueSx0LndpZHRoLHQuaGVpZ2h0LHQub2JqKTticmVhaztjYXNlInJlY3RGcm9tQ2VudGVyIjpiLnJlY3RGcm9tQ2VudGVyKHQueCx0LnksdC53aWR0aCx0LmhlaWdodCx0Lm9iaik7YnJlYWs7Y2FzZSJyZWN0RnJvbVBvaW50cyI6Yi5yZWN0RnJvbVBvaW50cyh0LngxLHQueTEsdC54Mix0LnkyLHQub2JqKTticmVhaztjYXNlInBvbHkiOmIucG9seSh0LnBvaW50cyx0Lm9iaik7YnJlYWs7Y2FzZSJjaXJjbGUiOmIuY2lyY2xlKHQueCx0LnksdC5yYWRpdXMsdC5vYmopO2JyZWFrO2Nhc2UiY2lyY2xlRnJvbVJlY3QiOmIuY2lyY2xlRnJvbVJlY3QodC54LHQueSx0LndpZHRoLHQuaGVpZ2h0LHQub2JqKTticmVhaztjYXNlInBvaW50IjpiLnBvaW50KHQueCx0LnksdC5vYmopO2JyZWFrO2Nhc2UicmVjdFNwcml0ZSI6Yi5yZWN0U3ByaXRlKHQueCx0LnksdC53aWR0aCx0LmhlaWdodCx0aGlzLmdldFRleHR1cmUodC50ZXh0dXJlSWQpKTticmVhaztjYXNlImNpcmNsZVNwcml0ZSI6Yi5jaXJjbGVTcHJpdGUodC54LHQueSx0LnJhZGl1cyx0aGlzLmdldFRleHR1cmUodC50ZXh0dXJlSWQpKTticmVhaztjYXNlInRleHQiOmIudGV4dCh0LnRleHQsdC54LHQueSx0LmZvbnQpO2JyZWFrO2Nhc2UidGludCI6Yi50aW50KHQuY29sb3IsdC54LHQueSx0LndpZHRoLHQuaGVpZ2h0KX19fTsK",{type:"module"})}let z=!1,T=[];const M=new Map;class P{static get worker(){return H}static get workerIsInitialized(){return z}static get offscreenCanvas(){return K}static get renderStack(){return T}static create(t,e){let[i,s]=[c().width,c().height];return I=h(t||i,e||s,1),P.initRenderWorker(I,t||i,e||s),p(I,"main"),I}static createFromCanvas(t){if(I=document.querySelector(t),!(I&&I instanceof HTMLCanvasElement))throw new v("The selected element is not a canvas");return u(I,I.clientWidth,I.clientHeight,1),P.initRenderWorker(I,I.width,I.height),I}static initRenderWorker(t,e,i){"offscreen"!==tt.rendererType&&tt.setRendererType("offscreen");let{clientWidth:s,clientHeight:n}=t;H=new F,K=t.transferControlToOffscreen(),this.sendMessageToWorker("initCanvas",{width:e||s,height:i||n,canvas:K,dpr:window.devicePixelRatio||1},[K]),H.onmessage=({data:{title:t,data:e}})=>{switch(t){case"log":console.log("message from the renderer worker : ",e);break;case"initialized":z=!0}}}static addRenderCall(t,e){T.push(new U(t,e||{}))}static sendMessageToWorker(t,e,i){return H.postMessage(new E(t,e),i||[])}static style(t){this.addRenderCall("style",{obj:t})}static clear(t){this.addRenderCall("clear",{color:t})}static line(t,e,i,s,n){this.addRenderCall("line",{x1:t,y1:e,x2:i,y2:s,obj:n})}static rect(t,e,i,s,n){this.addRenderCall("rect",{x:t,y:e,width:i,height:s,obj:n})}static rectFromCenter(t,e,i,s,n){this.addRenderCall("rectFromCenter",{x:t,y:e,width:i,height:s,obj:n})}static rectFromPoints(t,e,i,s,n){this.addRenderCall("rectFromPoints",{x1:t,y1:e,x2:i,y2:s,obj:n})}static poly(t,e){this.addRenderCall("poly",{points:t,obj:e})}static circle(t,e,i,s){this.addRenderCall("circle",{x:t,y:e,radius:i,obj:s})}static circleFromRect(t,e,i,s,n){this.addRenderCall("circleFromRect",{x:t,y:e,width:i,height:s,obj:n})}static point(t,e,i){this.addRenderCall("point",{x:t,y:e,obj:i})}static rectSprite(t,e,i,s,n){var a;M.has(n.id)?this.addRenderCall("rectSprite",{x:t,y:e,width:i,height:s,textureId:n.id}):null==(a=n.convertToBitmap())||a.then((t=>{M.set(n.id,t),this.sendMessageToWorker("newTexture",{id:n.id,texture:t})}))}static async circleSprite(t,e,i,s){var n;M.has(s.id)?this.addRenderCall("circleSprite",{x:t,y:e,radius:i,textureId:s.id}):null==(n=s.convertToBitmap())||n.then((t=>{M.set(s.id,t),this.sendMessageToWorker("newTexture",{id:s.id,texture:t})}))}static text(t,e,i,s){this.addRenderCall("text",{text:t,x:e,y:i,font:s})}static tint(t,e,i,s,n){this.addRenderCall("circle",{color:t,x:e,y:i,width:s,height:n})}static beginFrame(t){T=[],this.clear(t)}static endFrame(){z&&(this.sendMessageToWorker("render",{renderStack:T}),T=[])}}const j=y("OffscreenCanvas")?P:J;let Q=0;let B=[],D=4;const O=["top-left","top-right","bottom-left","bottom-right","custom"];class _{static addItem(t,e,i){_.internalAddItem(t,e,i)}static addButton(t,e,i,s){_.internalAddItem(t,i,s,e)}static internalAddItem(t,e,i,s){const n={callback:t,position:e,options:i,onClick:s};B.push(n);const a=B.length;window.addEventListener("load",(()=>_.addToDom(n,a)))}static init(){_.addStyle('*,\n*::after,\n*::before {\n    box-sizing: border-box;\n}\n\nbody {\n    margin: 0;\n    font-family: "Roboto";\n    font-weight: 400;\n    width: 100vw;\n    height: 100vh;\n    overflow: hidden;\n}\n\ncanvas {\n    z-index: 10;\n}\n\n.ue-interface {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    display: flex;\n    padding: 0.5em;\n    z-index: 10;\n    /* Make the click event pass through */\n    pointer-events: none;\n}\n\n.ue-container>div {\n    position: absolute;\n    display: flex;\n    flex-flow: column nowrap;\n}\n\n.ue-container>.top-left {\n    top: 0;\n    left: 0;\n}\n\n.ue-container>.top-right {\n    top: 0;\n    right: 0;\n    text-align: right;\n}\n\n.ue-container>.bottom-left {\n    bottom: 0;\n    left: 0;\n}\n\n.ue-container>.bottom-right {\n    bottom: 0;\n    right: 0;\n    text-align: right;\n}\n\n.ue-interface-items {\n    padding: .1em;\n}\n\n.ue-interface-button {\n    cursor: pointer;\n    user-select: none;\n}');const t=document.createElement("div");t.classList.add("ue-interface","ue-container");for(let e of O){const i=document.createElement("div");i.classList.add(e),t.appendChild(i)}document.body.appendChild(t)}static addStyle(t){const e=document.createElement("style");e.textContent=t,document.head.append(e)}static addToDom(t,e){var i,s;const n=t.callback(),a=document.createElement("span");a.classList.add("ue-interface-items"),a.id=`item-${e}`,a.innerText=n,Object.entries(t.options||{}).forEach((([t,e])=>a.style[t]=e)),t.position?null==(i=document.querySelector(`.ue-container > .${t.position}`))||i.appendChild(a):null==(s=document.querySelector(".ue-container > .custom"))||s.appendChild(a),t.onClick&&(a.addEventListener("click",(e=>t.onClick(e))),a.classList.add("ue-interface-button"))}static update(){B.forEach(((t,e)=>{const i=t.callback(),s=document.querySelector(`.ue-interface #item-${e+1}`);s&&s.innerText!==i&&(s.innerText=i)}))}static statsShift(t){const e=document.querySelector(".top-left");e&&(e.style.top=`${t}px`)}static setUpdateInterval(t){D=t}static get updateInterval(){return D}}function A(){const t=new R,e=document.createElement("div");return e.classList.toggle("stats"),t.showPanel(0),e.appendChild(t.dom),document.body.appendChild(e),_.statsShift(48),t}class q{constructor(t,e=60){if(this.requestId=0,this.animate=t,this.fps=e,!window)throw new S("No window context","core")}start(){let t=b();const e=1e3/this.fps,i=s=>{this.requestId=window.requestAnimationFrame(i);const n=s-t;n>=e-.1&&(t=s-n%e,this.animate(n))};this.requestId=window.requestAnimationFrame(i)}stop(){window.cancelAnimationFrame(this.requestId)}}let $="normal";class tt{constructor(t,e,i=60){this.fps=60,this.name=t,this.env=e,this.tick=0,this.stats=null,this.showStatsPanel=!0,this.gameLoop=this.env?()=>e.update():null,this.fps=i}static setRendererType(t){$=t}static get rendererType(){return $}toggleStats(t){this.showStatsPanel=void 0!==t?t:!this.showStatsPanel,this.showStatsPanel?this.stats=A():(this.stats=null,document.querySelector(".stats")&&document.querySelector(".stats").remove())}makeAnimationFrame(){this.animationFrame=new q((t=>this.update(t)),this.fps)}setMainLoop(t){this.gameLoop=t,this.makeAnimationFrame()}setFPS(t){this.fps=t,this.makeAnimationFrame()}update(t){var e,i;null==(e=this.stats)||e.begin(),g.tick(),w.tick(t),this.gameLoop&&this.gameLoop(t),this.tick%_.updateInterval==0&&_.update(),null==(i=this.stats)||i.end(),this.tick++}start(){if(!this.gameLoop)throw new Error("No game loop");if(!this.animationFrame)throw new Error("AnimationFrame");window.addEventListener("DOMContentLoaded",(()=>{var t;this.name&&(document.title=this.name),g.init(),w.init(),_.init(),this.showStatsPanel&&(this.stats=A()),null==(t=this.animationFrame)||t.start()}))}}class et{constructor(t,e){this.x=t,this.y=e}collide(t){return!!(t.width&&t.height&&this.width&&this.height)&&(this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.height+this.y>t.y)}update(...t){}render(...t){}}class it{constructor(t,e){this.delay=t,this.callback=e,window.setTimeout(this.callback,this.delay)}}class st extends et{constructor(t,e,i=5,n,a){super(e.x,e.y),this.radius=2,this.id=t,this.pos=e.clone(),this.angle=n&&"random"!=n?n%2*Math.PI:Math.PI/2+2*Math.random()*Math.PI,this.velocity=new s(Math.random()*i*Math.cos(this.angle),Math.random()*i*Math.sin(this.angle)),this.color=a||"transparent",this.opacity=l(100,255*Math.random(),255)}update(){this.velocity.y+=.01,this.pos=this.pos.add(this.velocity),this.opacity-=2}render(){switch(tt.rendererType){case"normal":J.circle(this.pos.x,this.pos.y,this.radius,{fillStyle:this.color,lineWidth:1,globalAlpha:this.opacity/255});break;case"offscreen":j.circle(this.pos.x,this.pos.y,this.radius,{fillStyle:this.color,lineWidth:1,globalAlpha:this.opacity/255})}}}class nt{constructor(t,e,i=1,s=1){this.x=t,this.y=e,this.width=i,this.height=s,this.state=null,this.neighboor={}}}const at={linear:t=>t,smoothStep:t=>(3-2*t)*t**2,smootherStep:t=>(6*t*t-15*t+10)*t**3,easeIn:t=>t**2,easeOut:t=>1-(1-t)**2,easeInOut:t=>t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2,easeInBack:t=>2.70158*t**3-1.70158*t**2,easeOutBack:t=>1+1.70158*Math.pow(t-1,3)+2.70158*Math.pow(t-1,2),easeInOutBack:t=>t<.5?Math.pow(2*t,2)*(7.189819*t-2.5949095)/2:(Math.pow(2*t-2,2)*(3.5949095*(2*t-2)+2.5949095)+2)/2},ot={autostart:!1,loop:!1};t.Animation=class{constructor(t,e,i,s=at.linear,n={}){if(this.hasStarted=!1,this.isPaused=!1,this.isEnded=!1,this.isReversed=!1,this.lastT=0,this.from=t,this.to=e,this.duration=i,s instanceof Function)this.easing=s;else{if("string"!=typeof s||!(s in at))throw new S("Unknow easing parameter","animation");this.easing=at[s]}this.options=__spreadValues(__spreadValues({},ot),n),this.value=this.from,this.speed=(this.to-this.from)/this.duration,w.add(this)}start(){this.isEnded=!1,this.hasStarted=!0}reset(){this.lastT=0,this.isPaused=!1}toggle(t){void 0!==t&&(t?this.pause():this.resume()),this.isPaused?this.resume():this.pause()}pause(){this.isPaused=!0}resume(){this.isPaused=!1}update(t){if(!this.hasStarted||this.isPaused)return;let e=l(0,this.lastT+t*this.speed/Math.abs(this.to-this.from),1);if(e>=1||e<=0){if(!this.options.loop)return void(this.isEnded=!0);this.speed*=-1,this.isReversed=!this.isReversed}this.lastT=e,this.value=this.from+(this.to-this.from)*this.easing(e)}get isRunning(){return!(this.isEnded||this.isPaused)}},t.ApiIsSupported=y,t.Cell=nt,t.Config={},t.Cooldown=it,t.Easing=at,t.Event=Z,t.Game=tt,t.GameEnvironement=class{constructor(t,e){this.width=t,this.height=e}update(){}render(){}},t.GameObject=et,t.Grid=class{constructor(t,e){this.rows=e,this.cols=t,this.cells=[],this.focusCell=null,this.createCells(),this.defineNeighboors()}createCells(){for(let t=0;t<this.cols;t++)for(let e=0;e<this.rows;e++)this.cells.push(new nt(t,e))}updateCell(t){if(this.cells.includes(t)){if(1!==t.width||1!==t.height){if(t.width>1){let e=t.width-1,i=this.cells.filter((i=>i.y===t.y&&i.x>t.x&&i.x<=t.x+e));this.cells=this.cells.filter((t=>!i.includes(t)))}if(t.height>1){let e=t.height-1,i=this.cells.filter((i=>i.x===t.x&&i.y>t.y&&i.y<=t.y+e));this.cells=this.cells.filter((t=>!i.includes(t)))}}this.defineNeighboors(),this.cells[this.cells.indexOf(t)]=t}}defineNeighboors(){this.cells.forEach((t=>{t.neighboor.top=t.y>=1?this.cells.filter((e=>e.x<=t.x&&e.x+e.width>t.x&&e.y===t.y-t.height))[0]:null,t.neighboor.bottom=t.y<=this.rows-1?this.cells.filter((e=>e.x<=t.x&&e.x+e.width>t.x&&e.y===t.y+t.height))[0]:null,t.neighboor.left=t.x>=1?this.cells.filter((e=>e.y<=t.y&&e.y+e.height>t.y&&e.x===t.x-t.width))[0]:null,t.neighboor.right=t.x<=this.cols-1?this.cells.filter((e=>e.y<=t.y&&e.y+e.height>t.y&&e.x===t.x+t.width))[0]:null}))}get(t,e){return this.cells[t*this.cols+e]}clear(){this.cells.forEach((t=>t.state=null))}},t.Interface=_,t.OffscreenRenderer=j,t.Particle=st,t.ParticuleGenerator=class{constructor(t,e,s,n){this.pos=e,this.lifeDuration=s,this.particles=[],this.UUID=100*i.randint(1,100);for(let i=0;i<t;i++){let t=new st(this.UUID+i,this.pos);this.particles.push(t)}new it(this.lifeDuration,(()=>{this.destroy(),n&&n()}))}addParticles(t){return t.concat(this.particles)}removeParticles(t){const e=this.particles.length;return t.filter((t=>!r(t.id,this.UUID,this.UUID+e)))}destroy(){}},t.PlayerObject=class extends et{constructor(t,e){super(t,e)}update(...t){}render(...t){}},t.Point=n,t.Random=i,t.Renderer=J,t.Texture=class{constructor(t,e){if(!t)throw new Error("A source path to the resource must be provided");this.id=Q++,this.image=new Image,this.image.src=t,this.size=new s(this.image.width,this.image.height),this.options=e||{},this.rotation=this.options.rotation||0,this.offset=this.options.offset||a,this.scale=this.options.scale||o}async convertToBitmap(){if(!this.image.width||!this.image.height)return;const t=await createImageBitmap(this.image);return __spreadProps(__spreadValues({},this),{image:t})}},t.VERSION="0.4.7",t.V_NULL=a,t.V_UNIT=o,t.Vector2=s,t.adaptCanvasToDevicePixelRatio=u,t.blink=function(t,e,i=300){var s;null==(s=document.querySelector(t))||s.classList.toggle(e),setTimeout((()=>{var i;return null==(i=document.querySelector(t))?void 0:i.classList.toggle(e)}),i)},t.clamp=l,t.createCanvas=h,t.getCanvasDimensions=d,t.getWindowDimensions=c,t.hashObject=function(t){let e="";for(const i in t)e+=`#${i}:${t[i]}`;return e},t.inRange=r,t.insertCanvas=p,t.isWorker=m,t.now=b,Object.defineProperty(t,"__esModule",{value:!0}),t[Symbol.toStringTag]="Module"}));
