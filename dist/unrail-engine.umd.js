var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(t,e,s)=>e in t?__defProp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,__spreadValues=(t,e)=>{for(var s in e||(e={}))__hasOwnProp.call(e,s)&&__defNormalProp(t,s,e[s]);if(__getOwnPropSymbols)for(var s of __getOwnPropSymbols(e))__propIsEnum.call(e,s)&&__defNormalProp(t,s,e[s]);return t},__spreadProps=(t,e)=>__defProps(t,__getOwnPropDescs(e));!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["unrail-engine"]={})}(this,(function(t){"use strict";"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;class e{static random(){return Math.random()}static randint(t,e){return Math.floor(t+Math.random()*(e-t))}static choice(t){return t[~~(e.random()*t.length)]}static bool(){return e.random()>.5}static sign(){return e.choice([-1,1])}static percent(t){return e.random()<t/100}}var s=e;class i{constructor(t,e){this.x=t,this.y=e}add(t){return new i(this.x+t.x,this.y+t.y)}clone(){return new i(this.x,this.y)}dist(t){return Math.sqrt((this.x-t.x)**2+(this.y-t.y)**2)}}const n=i,a=new i(0,0),o=new i(1,1);function l(t,e,s){return Math.max(t,Math.min(e,s))}function r(t,e,s){return l(e,t,s)===t}var c,d;(d=c||(c={}))[d.KeyboardPressed=0]="KeyboardPressed",d[d.KeyboardDown=1]="KeyboardDown",d[d.Mouse=2]="Mouse",d[d.Window=3]="Window",d[d.Custom=4]="Custom",d[d.All=5]="All";class h{constructor(t,e,s=4){this.name=t,this.callback=e,this.type=s,this.listeners=[this.callback]}static emit(t,e){const s=u.getCustomEvent(t);s&&s.listeners.forEach((t=>t(e)))}static on(t,e){const s=u.getCustomEvent(t);if(s)s.listeners.push(e);else{const s=new h(t,e,4);u.addEvent(s)}}static onKeyDown(t,e){u.addEvent(new h(t,e,1))}static onKeyPressed(t,e){u.addEvent(new h(t,e,0))}static onMouseClick(t){u.addEvent(new h("click",t,2))}static onMouseMove(t){u.addEvent(new h("mousemove",t,2))}}const u=new class{constructor(){this.windowEvents=[],this.customEvents=[],this.mouseEvents=[],this.keyboardDownEvents=[],this.keyboardPressedEvents=[],this.currentKeyEvents=[]}init(){window.addEventListener("keydown",(t=>{this.currentKeyEvents.find((e=>e.code===t.code))||this.currentKeyEvents.push(t),this.keyboardPressedEvents.forEach((e=>{t.code===e.name&&e.callback(t)}))})),window.addEventListener("keyup",(t=>{this.currentKeyEvents.length&&(this.currentKeyEvents=this.currentKeyEvents.filter((e=>e.code!==t.code)))})),this.bindEvents()}addEvent(t){switch(t.type){case c.KeyboardDown:this.keyboardDownEvents.push(t);break;case c.KeyboardPressed:this.keyboardPressedEvents.push(t);break;case c.Mouse:this.mouseEvents.push(t),window.addEventListener(t.name,(e=>t.callback(e)));break;case c.Window:this.windowEvents.push(t),this.bindEvents();break;case c.Custom:this.customEvents.push(t)}}getCustomEvent(t){return this.customEvents.find((e=>e.name===t))}bindEvents(){this.windowEvents.forEach((t=>window.addEventListener(t.name,t.callback)))}tick(){this.currentKeyEvents.length&&this.keyboardDownEvents.forEach((t=>{this.currentKeyEvents.forEach((e=>{e.code===t.name&&t.callback(e)}))}))}};const p=new class{constructor(){this.hasStarted=!1,this.animations=[]}add(t){this.animations.push(t),this.hasStarted&&t.options.autostart&&t.start()}init(){this.hasStarted=!0;for(let t of this.animations)t.options.autostart&&t.start()}tick(t){for(let e of this.animations)e.update(t)}};var m,y={exports:{}};y.exports=((m=function(){function t(t){return i.appendChild(t.dom),t}function e(t){for(var e=0;e<i.children.length;e++)i.children[e].style.display=e===t?"block":"none";s=t}var s=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",(function(t){t.preventDefault(),e(++s%i.children.length)}),!1);var n=(performance||Date).now(),a=n,o=0,l=t(new m.Panel("FPS","#0ff","#002")),r=t(new m.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new m.Panel("MB","#f08","#201"));return e(0),{REVISION:16,dom:i,addPanel:t,showPanel:e,begin:function(){n=(performance||Date).now()},end:function(){o++;var t=(performance||Date).now();if(r.update(t-n,200),t>a+1e3&&(l.update(1e3*o/(t-a),100),a=t,o=0,c)){var e=performance.memory;c.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){n=this.end()},domElement:i,setMode:e}}).Panel=function(t,e,s){var i=1/0,n=0,a=Math.round,o=a(window.devicePixelRatio||1),l=80*o,r=48*o,c=3*o,d=2*o,h=3*o,u=15*o,p=74*o,m=30*o,y=document.createElement("canvas");y.width=l,y.height=r,y.style.cssText="width:80px;height:48px";var b=y.getContext("2d");return b.font="bold "+9*o+"px Helvetica,Arial,sans-serif",b.textBaseline="top",b.fillStyle=s,b.fillRect(0,0,l,r),b.fillStyle=e,b.fillText(t,c,d),b.fillRect(h,u,p,m),b.fillStyle=s,b.globalAlpha=.9,b.fillRect(h,u,p,m),{dom:y,update:function(r,x){i=Math.min(i,r),n=Math.max(n,r),b.fillStyle=s,b.globalAlpha=1,b.fillRect(0,0,l,u),b.fillStyle=e,b.fillText(a(r)+" "+t+" ("+a(i)+"-"+a(n)+")",c,d),b.drawImage(y,h+o,u,p-o,m,h,u,p-o,m),b.fillRect(h+p-o,u,o,m),b.fillStyle=s,b.globalAlpha=.9,b.fillRect(h+p-o,u,o,a((1-r/x)*m))}}},m);var b=y.exports;function x(){return{width:window.innerWidth,height:window.innerHeight}}function Z(t,e,s,i){const n=document.createElement("canvas");return f(n,t,e,s),i&&(n.oncontextmenu=t=>t.preventDefault()),n}function f(t,e,s,i){const n=i||window.devicePixelRatio||1;let a=e||t.width,o=s||t.height;t.width=a*n,t.height=o*n,t.style.width=a+"px",t.style.height=o+"px",1!=n&&t.getContext("2d").setTransform(n,0,0,n,0,0)}function g(t,e){window.addEventListener("DOMContentLoaded",(()=>{let s=document.querySelector(e);s||(s=document.createElement(e)),s.appendChild(t),document.querySelector("body").appendChild(s)}))}String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};class G extends Error{constructor(t,e){super(e?`[${e.capitalize()}] - ${t}`:t),this.name="EngineFailure"}}class w extends G{constructor(t){super(t,"renderer")}}const R={strokeStyle:"black",lineWidth:2,lineJoin:"round",fillStyle:"transparent",globalAlpha:1,globalCompositeOperation:"add"},v={font:"Roboto",size:16,color:"black"},L=2*Math.PI;let W,C,S,V,X,k=null==self.document&&null==self.window?4:2*(window.devicePixelRatio||1);function H(t){return~~(t*k)/k}class K{static create(t,e){let[s,i]=[x().width,x().height];const n=Z(t||s,e||i);return g(n,"main"),K.setContext(n.getContext("2d")),n}static createFromCanvas(t){let e=document.querySelector(t);if(!(e&&e instanceof HTMLCanvasElement))throw new w("The selected element is not a canvas");return f(e),K.setContext(e.getContext("2d")),e}static setContext(t){W=t}static getContext(){return W}static style(t){if(!W)throw new w("Context has not been initialize. Please use Renderer.setContext");const e=__spreadValues(__spreadValues({},R),t);if(e!==C){for(let t in e)W[t]!==e[t]&&(W[t]=e[t]);C=e}}static clear(t){t?(K.style({fillStyle:t}),W.fillRect(0,0,W.canvas.width,W.canvas.height)):W.clearRect(0,0,W.canvas.width,W.canvas.height)}static line(t,e,s,i,n){K.style(n),W.beginPath(),W.moveTo(H(t),H(e)),W.lineTo(H(s),H(i)),W.stroke()}static rect(t,e,s,i,n){K.style(n);const[a,o,l,r]=[H(t),H(e),H(s),H(i)];W.fillRect(a,o,l,r),W.strokeRect(a,o,l,r)}static rectFromCenter(t,e,s,i,n){return K.rect(t-s/2,e-i/2,s,i,n)}static rectFromPoints(t,e,s,i,n){return K.rect(t,e,s-t,i-e,n)}static poly(t,e){if(t.length){K.style(e),W.beginPath(),W.moveTo(H(t[0].x),H(t[0].y));for(let e=1;e<t.length;e++)W.lineTo(H(t[e].x),H(t[e].y));W.stroke()}}static circle(t,e,s,i){K.style(i),W.beginPath(),W.arc(H(t),H(e),s,0,L),W.fill(),W.stroke()}static circleFromRect(t,e,s,i,n){return K.circle(t+s/2,e+i/2,Math.min(s,i)/2,n)}static point(t,e,s){K.circle(t,e,5,s)}static rectSprite(t,e,s,i,n){K.style({}),W.save(),W.translate(H(t+s/2),H(e+i/2)),W.scale(n.scale.x,n.scale.y),W.rotate(n.rotation),W.drawImage(n.image,H(s*n.offset.x-s/2),H(i*n.offset.y-i/2),H(s),H(i)),W.restore()}static circleSprite(t,e,s,i){W.save(),W.beginPath(),W.arc(H(t),H(e),s,0,L),W.clip(),K.rectSprite(t-s,e-s,2*s,2*s,i),W.restore()}static text(t,e,s,i){if(W){let t=__spreadValues(__spreadValues({},v),i);W.font=`${t.size}px ${t.font}`,K.style({fillStyle:t.color})}W.fillText(t,e,s)}static tint(t,e,s,i,n){K.rect(e,s,i,n,{fillStyle:t,globalCompositeOperation:"multiply",globalAlpha:.25})}static beginFrame(t){K.clear(t)}static endFrame(){}}class Y{constructor(t,e){this.title=t,this.content=e}}class I{constructor(t,e){this.methodName=t,this.args=e}}function N(){return new Worker("data:application/javascript;base64,dmFyIGU9T2JqZWN0LmRlZmluZVByb3BlcnR5LHQ9T2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyxpPU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkscj1PYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlLHM9KHQsaSxyKT0+aSBpbiB0P2UodCxpLHtlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMCx3cml0YWJsZTohMCx2YWx1ZTpyfSk6dFtpXT1yLGE9KGUsYSk9Pntmb3IodmFyIG4gaW4gYXx8KGE9e30pKWkuY2FsbChhLG4pJiZzKGUsbixhW25dKTtpZih0KWZvcih2YXIgbiBvZiB0KGEpKXIuY2FsbChhLG4pJiZzKGUsbixhW25dKTtyZXR1cm4gZX07ZnVuY3Rpb24gbigpe3JldHVybnt3aWR0aDp3aW5kb3cuaW5uZXJXaWR0aCxoZWlnaHQ6d2luZG93LmlubmVySGVpZ2h0fX1mdW5jdGlvbiBvKGUsdCxpLHIpe2NvbnN0IHM9cnx8d2luZG93LmRldmljZVBpeGVsUmF0aW98fDE7bGV0IGE9dHx8ZS53aWR0aCxuPWl8fGUuaGVpZ2h0O2Uud2lkdGg9YSpzLGUuaGVpZ2h0PW4qcyxlLnN0eWxlLndpZHRoPWErInB4IixlLnN0eWxlLmhlaWdodD1uKyJweCIsMSE9cyYmZS5nZXRDb250ZXh0KCIyZCIpLnNldFRyYW5zZm9ybShzLDAsMCxzLDAsMCl9U3RyaW5nLnByb3RvdHlwZS5jYXBpdGFsaXplPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkrdGhpcy5zbGljZSgxKX07Y2xhc3MgYyBleHRlbmRzIEVycm9ye2NvbnN0cnVjdG9yKGUsdCl7c3VwZXIodD9gWyR7dC5jYXBpdGFsaXplKCl9XSAtICR7ZX1gOmUpLHRoaXMubmFtZT0iRW5naW5lRmFpbHVyZSJ9fWNsYXNzIGwgZXh0ZW5kcyBje2NvbnN0cnVjdG9yKGUpe3N1cGVyKGUsInJlbmRlcmVyIil9fWNvbnN0IGg9e3N0cm9rZVN0eWxlOiJibGFjayIsbGluZVdpZHRoOjIsbGluZUpvaW46InJvdW5kIixmaWxsU3R5bGU6InRyYW5zcGFyZW50IixnbG9iYWxBbHBoYToxLGdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbjoiYWRkIn0sZD17Zm9udDoiUm9ib3RvIixzaXplOjE2LGNvbG9yOiJibGFjayJ9LHU9MipNYXRoLlBJO2xldCB4LGYscD1udWxsPT1zZWxmLmRvY3VtZW50JiZudWxsPT1zZWxmLndpbmRvdz80OjIqKHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvfHwxKTtmdW5jdGlvbiBnKGUpe3JldHVybn5+KGUqcCkvcH1jbGFzcyB5e3N0YXRpYyBjcmVhdGUoZSx0KXtsZXRbaSxyXT1bbigpLndpZHRoLG4oKS5oZWlnaHRdO2NvbnN0IHM9ZnVuY3Rpb24oZSx0LGkscil7Y29uc3Qgcz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJjYW52YXMiKTtyZXR1cm4gbyhzLGUsdCxpKSxyJiYocy5vbmNvbnRleHRtZW51PWU9PmUucHJldmVudERlZmF1bHQoKSksc30oZXx8aSx0fHxyKTtyZXR1cm4gZnVuY3Rpb24oZSx0KXt3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsKCgpPT57bGV0IGk9ZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0KTtpfHwoaT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KHQpKSxpLmFwcGVuZENoaWxkKGUpLGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoImJvZHkiKS5hcHBlbmRDaGlsZChpKX0pKX0ocywibWFpbiIpLHkuc2V0Q29udGV4dChzLmdldENvbnRleHQoIjJkIikpLHN9c3RhdGljIGNyZWF0ZUZyb21DYW52YXMoZSl7bGV0IHQ9ZG9jdW1lbnQucXVlcnlTZWxlY3RvcihlKTtpZighKHQmJnQgaW5zdGFuY2VvZiBIVE1MQ2FudmFzRWxlbWVudCkpdGhyb3cgbmV3IGwoIlRoZSBzZWxlY3RlZCBlbGVtZW50IGlzIG5vdCBhIGNhbnZhcyIpO3JldHVybiBvKHQpLHkuc2V0Q29udGV4dCh0LmdldENvbnRleHQoIjJkIikpLHR9c3RhdGljIHNldENvbnRleHQoZSl7eD1lfXN0YXRpYyBnZXRDb250ZXh0KCl7cmV0dXJuIHh9c3RhdGljIHN0eWxlKGUpe2lmKCF4KXRocm93IG5ldyBsKCJDb250ZXh0IGhhcyBub3QgYmVlbiBpbml0aWFsaXplLiBQbGVhc2UgdXNlIFJlbmRlcmVyLnNldENvbnRleHQiKTtjb25zdCB0PWEoYSh7fSxoKSxlKTtpZih0IT09Zil7Zm9yKGxldCBlIGluIHQpeFtlXSE9PXRbZV0mJih4W2VdPXRbZV0pO2Y9dH19c3RhdGljIGNsZWFyKGUpe2U/KHkuc3R5bGUoe2ZpbGxTdHlsZTplfSkseC5maWxsUmVjdCgwLDAseC5jYW52YXMud2lkdGgseC5jYW52YXMuaGVpZ2h0KSk6eC5jbGVhclJlY3QoMCwwLHguY2FudmFzLndpZHRoLHguY2FudmFzLmhlaWdodCl9c3RhdGljIGxpbmUoZSx0LGkscixzKXt5LnN0eWxlKHMpLHguYmVnaW5QYXRoKCkseC5tb3ZlVG8oZyhlKSxnKHQpKSx4LmxpbmVUbyhnKGkpLGcocikpLHguc3Ryb2tlKCl9c3RhdGljIHJlY3QoZSx0LGkscixzKXt5LnN0eWxlKHMpO2NvbnN0W2EsbixvLGNdPVtnKGUpLGcodCksZyhpKSxnKHIpXTt4LmZpbGxSZWN0KGEsbixvLGMpLHguc3Ryb2tlUmVjdChhLG4sbyxjKX1zdGF0aWMgcmVjdEZyb21DZW50ZXIoZSx0LGkscixzKXtyZXR1cm4geS5yZWN0KGUtaS8yLHQtci8yLGkscixzKX1zdGF0aWMgcmVjdEZyb21Qb2ludHMoZSx0LGkscixzKXtyZXR1cm4geS5yZWN0KGUsdCxpLWUsci10LHMpfXN0YXRpYyBwb2x5KGUsdCl7aWYoZS5sZW5ndGgpe3kuc3R5bGUodCkseC5iZWdpblBhdGgoKSx4Lm1vdmVUbyhnKGVbMF0ueCksZyhlWzBdLnkpKTtmb3IobGV0IHQ9MTt0PGUubGVuZ3RoO3QrKyl4LmxpbmVUbyhnKGVbdF0ueCksZyhlW3RdLnkpKTt4LnN0cm9rZSgpfX1zdGF0aWMgY2lyY2xlKGUsdCxpLHIpe3kuc3R5bGUocikseC5iZWdpblBhdGgoKSx4LmFyYyhnKGUpLGcodCksaSwwLHUpLHguZmlsbCgpLHguc3Ryb2tlKCl9c3RhdGljIGNpcmNsZUZyb21SZWN0KGUsdCxpLHIscyl7cmV0dXJuIHkuY2lyY2xlKGUraS8yLHQrci8yLE1hdGgubWluKGkscikvMixzKX1zdGF0aWMgcG9pbnQoZSx0LGkpe3kuY2lyY2xlKGUsdCw1LGkpfXN0YXRpYyByZWN0U3ByaXRlKGUsdCxpLHIscyl7eS5zdHlsZSh7fSkseC5zYXZlKCkseC50cmFuc2xhdGUoZyhlK2kvMiksZyh0K3IvMikpLHguc2NhbGUocy5zY2FsZS54LHMuc2NhbGUueSkseC5yb3RhdGUocy5yb3RhdGlvbikseC5kcmF3SW1hZ2Uocy5pbWFnZSxnKGkqcy5vZmZzZXQueC1pLzIpLGcocipzLm9mZnNldC55LXIvMiksZyhpKSxnKHIpKSx4LnJlc3RvcmUoKX1zdGF0aWMgY2lyY2xlU3ByaXRlKGUsdCxpLHIpe3guc2F2ZSgpLHguYmVnaW5QYXRoKCkseC5hcmMoZyhlKSxnKHQpLGksMCx1KSx4LmNsaXAoKSx5LnJlY3RTcHJpdGUoZS1pLHQtaSwyKmksMippLHIpLHgucmVzdG9yZSgpfXN0YXRpYyB0ZXh0KGUsdCxpLHIpe2lmKHgpe2xldCBlPWEoYSh7fSxkKSxyKTt4LmZvbnQ9YCR7ZS5zaXplfXB4ICR7ZS5mb250fWAseS5zdHlsZSh7ZmlsbFN0eWxlOmUuY29sb3J9KX14LmZpbGxUZXh0KGUsdCxpKX1zdGF0aWMgdGludChlLHQsaSxyLHMpe3kucmVjdCh0LGkscixzLHtmaWxsU3R5bGU6ZSxnbG9iYWxDb21wb3NpdGVPcGVyYXRpb246Im11bHRpcGx5IixnbG9iYWxBbHBoYTouMjV9KX1zdGF0aWMgYmVnaW5GcmFtZShlKXt5LmNsZWFyKGUpfXN0YXRpYyBlbmRGcmFtZSgpe319bmV3IGNsYXNzIGV4dGVuZHMgY2xhc3N7c2VuZE1lc3NhZ2VUb01haW5UaHJlYWQoZSx0KXtzZWxmLnBvc3RNZXNzYWdlKHt0aXRsZTplLGRhdGE6dH0pfWxvZyguLi5lKXt0aGlzLnNlbmRNZXNzYWdlVG9NYWluVGhyZWFkKCJsb2ciLC4uLmUpfX17Y29uc3RydWN0b3IoKXtzdXBlcigpLHRoaXMuY2FudmFzUmVzb2x1dGlvbj0xLHRoaXMub2Zmc2NyZWVuQ2FudmFzPW51bGwsdGhpcy5jdHg9bnVsbCx0aGlzLnRleHR1cmVBbGlhcz1uZXcgTWFwLHNlbGYuYWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsKCh7ZGF0YTplfSk9PnRoaXMub25NZXNzYWdlKGUudGl0bGUsZS5jb250ZW50KSkpfW9uTWVzc2FnZShlLHQpe3N3aXRjaChlKXtjYXNlImluaXRDYW52YXMiOnRoaXMub2Zmc2NyZWVuQ2FudmFzPXQuY2FudmFzLHRoaXMuY3R4PXRoaXMub2Zmc2NyZWVuQ2FudmFzLmdldENvbnRleHQoIjJkIikseS5zZXRDb250ZXh0KHRoaXMuY3R4KSx0aGlzLnNldFNpemUodC5kcHIsdC53aWR0aCx0LmhlaWdodCksdGhpcy5zZW5kTWVzc2FnZVRvTWFpblRocmVhZCgiaW5pdGlhbGl6ZWQiKTticmVhaztjYXNlInJlbmRlciI6Zm9yKGxldCBlIG9mIHQucmVuZGVyU3RhY2spdGhpcy5oYW5kbGVEcmF3UmVxdWVzdChlLm1ldGhvZE5hbWUsZS5hcmdzKTticmVhaztjYXNlIm5ld1RleHR1cmUiOnRoaXMudGV4dHVyZUFsaWFzW3QuaWRdPXQudGV4dHVyZX19c2V0U2l6ZShlLHQsaSl7Y29uc3Qgcj0oZXx8MSkqdGhpcy5jYW52YXNSZXNvbHV0aW9uO3RoaXMub2Zmc2NyZWVuQ2FudmFzLndpZHRoPXQqcix0aGlzLm9mZnNjcmVlbkNhbnZhcy5oZWlnaHQ9aSpyLCJzZXRUcmFuc2Zvcm0iaW4gdGhpcy5jdHgmJnRoaXMuY3R4LnNldFRyYW5zZm9ybShyLDAsMCxyLDAsMCl9Z2V0VGV4dHVyZShlKXtyZXR1cm4gdGhpcy50ZXh0dXJlQWxpYXNbZV19aGFuZGxlRHJhd1JlcXVlc3QoZSx0KXtzd2l0Y2goZSl7Y2FzZSJzdHlsZSI6eS5zdHlsZShudWxsPT10P3ZvaWQgMDp0Lm9iaik7YnJlYWs7Y2FzZSJjbGVhciI6eS5jbGVhcihudWxsPT10P3ZvaWQgMDp0LmNvbG9yKTticmVhaztjYXNlImxpbmUiOnkubGluZSh0LngxLHQueTEsdC54Mix0LnkyLHQub2JqKTticmVhaztjYXNlInJlY3QiOnkucmVjdCh0LngsdC55LHQud2lkdGgsdC5oZWlnaHQsdC5vYmopO2JyZWFrO2Nhc2UicmVjdEZyb21DZW50ZXIiOnkucmVjdEZyb21DZW50ZXIodC54LHQueSx0LndpZHRoLHQuaGVpZ2h0LHQub2JqKTticmVhaztjYXNlInJlY3RGcm9tUG9pbnRzIjp5LnJlY3RGcm9tUG9pbnRzKHQueDEsdC55MSx0LngyLHQueTIsdC5vYmopO2JyZWFrO2Nhc2UicG9seSI6eS5wb2x5KHQucG9pbnRzLHQub2JqKTticmVhaztjYXNlImNpcmNsZSI6eS5jaXJjbGUodC54LHQueSx0LnJhZGl1cyx0Lm9iaik7YnJlYWs7Y2FzZSJjaXJjbGVGcm9tUmVjdCI6eS5jaXJjbGVGcm9tUmVjdCh0LngsdC55LHQud2lkdGgsdC5oZWlnaHQsdC5vYmopO2JyZWFrO2Nhc2UicG9pbnQiOnkucG9pbnQodC54LHQueSx0Lm9iaik7YnJlYWs7Y2FzZSJyZWN0U3ByaXRlIjp5LnJlY3RTcHJpdGUodC54LHQueSx0LndpZHRoLHQuaGVpZ2h0LHRoaXMuZ2V0VGV4dHVyZSh0LnRleHR1cmVJZCkpO2JyZWFrO2Nhc2UiY2lyY2xlU3ByaXRlIjp5LmNpcmNsZVNwcml0ZSh0LngsdC55LHQucmFkaXVzLHRoaXMuZ2V0VGV4dHVyZSh0LnRleHR1cmVJZCkpO2JyZWFrO2Nhc2UidGV4dCI6eS50ZXh0KHQudGV4dCx0LngsdC55LHQuZm9udCk7YnJlYWs7Y2FzZSJ0aW50Ijp5LnRpbnQodC5jb2xvcix0LngsdC55LHQud2lkdGgsdC5oZWlnaHQpfX19Owo=",{type:"module"})}let F=!1,E=[];const U=new Map;class M{static get worker(){return V}static get workerIsInitialized(){return F}static get offscreenCanvas(){return S}static get renderStack(){return E}static create(t,e){let[s,i]=[x().width,x().height];return X=Z(t||s,e||i,1),M.initRenderWorker(X,t||s,e||i),g(X,"main"),X}static createFromCanvas(t){if(X=document.querySelector(t),!(X&&X instanceof HTMLCanvasElement))throw new w("The selected element is not a canvas");return f(X,X.width,X.height,1),M.initRenderWorker(X,X.width,X.height),X}static initRenderWorker(t,e,s){"offscreen"!==_.rendererType&&_.setRendererType("offscreen");let{clientWidth:i,clientHeight:n}=t;V=new N,S=t.transferControlToOffscreen(),this.sendMessageToWorker("initCanvas",{width:e||i,height:s||n,canvas:S,dpr:window.devicePixelRatio||1},[S]),V.onmessage=({data:{title:t,data:e}})=>{switch(t){case"log":console.log("message from the renderer worker : ",e);break;case"initialized":F=!0}}}static addRenderCall(t,e){E.push(new I(t,e||{}))}static sendMessageToWorker(t,e,s){return V.postMessage(new Y(t,e),s||[])}static style(t){this.addRenderCall("style",{obj:t})}static clear(t){this.addRenderCall("clear",{color:t})}static line(t,e,s,i,n){this.addRenderCall("line",{x1:t,y1:e,x2:s,y2:i,obj:n})}static rect(t,e,s,i,n){this.addRenderCall("rect",{x:t,y:e,width:s,height:i,obj:n})}static rectFromCenter(t,e,s,i,n){this.addRenderCall("rectFromCenter",{x:t,y:e,width:s,height:i,obj:n})}static rectFromPoints(t,e,s,i,n){this.addRenderCall("rectFromPoints",{x1:t,y1:e,x2:s,y2:i,obj:n})}static poly(t,e){this.addRenderCall("poly",{points:t,obj:e})}static circle(t,e,s,i){this.addRenderCall("circle",{x:t,y:e,radius:s,obj:i})}static circleFromRect(t,e,s,i,n){this.addRenderCall("circleFromRect",{x:t,y:e,width:s,height:i,obj:n})}static point(t,e,s){this.addRenderCall("point",{x:t,y:e,obj:s})}static rectSprite(t,e,s,i,n){var a;U.has(n.id)?this.addRenderCall("rectSprite",{x:t,y:e,width:s,height:i,textureId:n.id}):null==(a=n.convertToBitmap())||a.then((t=>{U.set(n.id,t),this.sendMessageToWorker("newTexture",{id:n.id,texture:t})}))}static async circleSprite(t,e,s,i){var n;U.has(i.id)?this.addRenderCall("circleSprite",{x:t,y:e,radius:s,textureId:i.id}):null==(n=i.convertToBitmap())||n.then((t=>{U.set(i.id,t),this.sendMessageToWorker("newTexture",{id:i.id,texture:t})}))}static text(t,e,s,i){this.addRenderCall("text",{text:t,x:e,y:s,font:i})}static tint(t,e,s,i,n){this.addRenderCall("circle",{color:t,x:e,y:s,width:i,height:n})}static beginFrame(t){E=[],this.clear(t)}static endFrame(){F&&(this.sendMessageToWorker("render",{renderStack:E}),E=[])}}let z=0;let T=[],P=4;const j=["top-left","top-right","bottom-left","bottom-right","custom"];class Q{static addItem(t,e,s){Q.internalAddItem(t,e,s)}static addButton(t,e,s,i){Q.internalAddItem(t,s,i,e)}static internalAddItem(t,e,s,i){const n={callback:t,position:e,options:s,onClick:i};T.push(n);const a=T.length;window.addEventListener("load",(()=>Q.addToDom(n,a)))}static init(){Q.addStyle('*,\n*::after,\n*::before {\n    box-sizing: border-box;\n}\n\nbody {\n    margin: 0;\n    font-family: "Roboto";\n    font-weight: 400;\n    width: 100vw;\n    height: 100vh;\n    overflow: hidden;\n}\n\ncanvas {\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n    z-index: 2;\n}\n\n.ue-interface {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    display: flex;\n    padding: 0.5em;\n    z-index: 10;\n    /* Make the click event pass through */\n    pointer-events: none;\n}\n\n.ue-container>div {\n    position: absolute;\n    display: flex;\n    flex-flow: column nowrap;\n}\n\n.ue-container>.top-left {\n    top: 0;\n    left: 0;\n}\n\n.ue-container>.top-right {\n    top: 0;\n    right: 0;\n    text-align: right;\n}\n\n.ue-container>.bottom-left {\n    bottom: 0;\n    left: 0;\n}\n\n.ue-container>.bottom-right {\n    bottom: 0;\n    right: 0;\n    text-align: right;\n}\n\n.ue-interface-items {\n    padding: .1em;\n}\n\n.ue-interface-button {\n    cursor: pointer;\n    user-select: none;\n}');const t=document.createElement("div");t.classList.add("ue-interface","ue-container");for(let e of j){const s=document.createElement("div");s.classList.add(e),t.appendChild(s)}document.body.appendChild(t)}static addStyle(t){const e=document.createElement("style");e.textContent=t,document.head.append(e)}static addToDom(t,e){var s,i;const n=t.callback(),a=document.createElement("span");a.classList.add("ue-interface-items"),a.id=`item-${e}`,a.innerText=n,Object.entries(t.options||{}).forEach((([t,e])=>a.style[t]=e)),t.position?null==(s=document.querySelector(`.ue-container > .${t.position}`))||s.appendChild(a):null==(i=document.querySelector(".ue-container > .custom"))||i.appendChild(a),t.onClick&&(a.addEventListener("click",(e=>t.onClick(e))),a.classList.add("ue-interface-button"))}static update(){T.forEach(((t,e)=>{const s=t.callback(),i=document.querySelector(`.ue-interface #item-${e+1}`);i&&i.innerText!==s&&(i.innerText=s)}))}static statsShift(t){const e=document.querySelector(".top-left");e&&(e.style.top=`${t}px`)}static setUpdateInterval(t){P=t}static get updateInterval(){return P}}function J(){const t=new b,e=document.createElement("div");return e.classList.toggle("stats"),t.showPanel(0),e.appendChild(t.dom),document.body.appendChild(e),Q.statsShift(48),t}class B{constructor(t,e=60){if(this.requestId=0,this.animate=t,this.fps=e,!window)throw new Error("No window context")}start(){let t=performance.now();const e=1e3/this.fps,s=i=>{this.requestId=window.requestAnimationFrame(s);const n=i-t;n>=e-.1&&(t=i-n%e,this.animate(n))};this.requestId=window.requestAnimationFrame(s)}stop(){window.cancelAnimationFrame(this.requestId)}}let O="normal";class _{constructor(t,e,s=60){this.fps=60,this.name=t,this.env=e,this.tick=0,this.stats=null,this.showStatsPanel=!0,this.gameLoop=null,this.fps=s}static setRendererType(t){O=t}static get rendererType(){return O}toggleStats(t){this.showStatsPanel=void 0!==t?t:!this.showStatsPanel,this.showStatsPanel?this.stats=J():(this.stats=null,document.querySelector(".stats")&&document.querySelector(".stats").remove())}makeAnimationFrame(){this.animationFrame=new B((t=>this.update(t)),this.fps)}setMainLoop(t){this.gameLoop=t,this.makeAnimationFrame()}setFPS(t){this.fps=t,this.makeAnimationFrame()}update(t){var e,s;null==(e=this.stats)||e.begin(),u.tick(),p.tick(t),this.gameLoop&&this.gameLoop(t),this.tick%Q.updateInterval==0&&Q.update(),null==(s=this.stats)||s.end(),this.tick++}start(){if(!this.gameLoop)throw new Error("No game loop");if(!this.animationFrame)throw new Error("AnimationFrame");window.addEventListener("DOMContentLoaded",(()=>{var t;this.name&&(document.title=this.name),u.init(),p.init(),Q.init(),this.showStatsPanel&&(this.stats=J()),null==(t=this.animationFrame)||t.start()}))}}class D{constructor(t,e){this.x=t,this.y=e}collide(t){return!!(t.width&&t.height&&this.width&&this.height)&&(this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.height+this.y>t.y)}update(...t){}render(...t){}}class A{constructor(t,e){this.delay=t,this.callback=e,window.setTimeout(this.callback,this.delay)}}class q extends D{constructor(t,e,s=5,n,a){super(e.x,e.y),this.id=t,this.pos=e.clone(),this.angle=n&&"random"!=n?n%2*Math.PI:Math.PI/2+2*Math.random()*Math.PI,this.velocity=new i(Math.random()*s*Math.cos(this.angle),Math.random()*s*Math.sin(this.angle)),this.color=a||"transparent",this.opacity=l(100,255*Math.random(),255),this.radius=2}update(){this.velocity.y+=.01,this.pos=this.pos.add(this.velocity),this.opacity-=2}render(){switch(_.rendererType){case"normal":K.circle(this.pos.x,this.pos.y,this.radius,{fillStyle:this.color,lineWidth:1,globalAlpha:this.opacity/255});break;case"offscreen":M.circle(this.pos.x,this.pos.y,this.radius,{fillStyle:this.color,lineWidth:1,globalAlpha:this.opacity/255})}}}var $,tt;(tt=$||($={}))[tt.Turret=0]="Turret",tt[tt.Road=1]="Road",tt[tt.Ground=2]="Ground",tt[tt.Empty=3]="Empty";class et{constructor(t,e,s=1,i=1){this.x=t,this.y=e,this.width=s,this.height=i,this.highlight=!1,this.type=2,this.neighboor={}}toggleHighlight(){this.highlight=!this.highlight}}const st={linear:t=>t,easeIn:t=>t**2,easeOut:t=>1-(1-t)**2,easeInOut:t=>t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2,easeInBack:t=>2.70158*t**3-1.70158*t**2,easeOutBack:t=>1+1.70158*Math.pow(t-1,3)+2.70158*Math.pow(t-1,2),easeInOutBack:t=>t<.5?Math.pow(2*t,2)*(7.189819*t-2.5949095)/2:(Math.pow(2*t-2,2)*(3.5949095*(2*t-2)+2.5949095)+2)/2},it={autostart:!1,loop:!1};t.Animation=class{constructor(t,e,s,i=st.linear,n={}){this.hasStarted=!1,this.isPaused=!1,this.isEnded=!1,this.isReversed=!1,this.from=t,this.to=e,this.duration=s,this.easing=i,this.options=__spreadValues(__spreadValues({},it),n),this.value=this.from,this.speed=(this.to-this.from)/this.duration,this.isReversed=!1,this.lastT=0,p.add(this)}start(){this.isEnded=!1,this.hasStarted=!0}reset(){this.lastT=0,this.isPaused=!1}toggle(t){void 0!==t&&(t?this.pause():this.resume()),this.isPaused?this.resume():this.pause()}pause(){this.isPaused=!0}resume(){this.isPaused=!1}update(t){if(!this.hasStarted||this.isPaused)return;let e=l(0,this.lastT+t*this.speed/Math.abs(this.to-this.from),1);if(e>=1||e<=0){if(!this.options.loop)return this.isEnded=!0,void(this.lastT=1);this.speed*=-1,this.isReversed=!this.isReversed}this.lastT=e,this.value=this.from+(this.to-this.from)*this.easing(e)}},t.Cell=et,t.Config={},t.Cooldown=A,t.Easing=st,t.Event=h,t.Game=_,t.GameEnvironement=class{constructor(t,e){this.width=t,this.height=e}update(){}render(){}},t.GameObject=D,t.Grid=class{constructor(t,e){this.rows=e,this.cols=t,this.cells=[],this.focusCell=null,this.createCells(),this.defineNeighboors()}createCells(){for(let t=0;t<this.cols;t++)for(let e=0;e<this.rows;e++)this.cells.push(new et(t,e))}updateCell(t){if(this.cells.includes(t)){if(1!==t.width||1!==t.height){if(t.width>1){let e=t.width-1,s=this.cells.filter((s=>s.y===t.y&&s.x>t.x&&s.x<=t.x+e));this.cells=this.cells.filter((t=>!s.includes(t)))}if(t.height>1){let e=t.height-1,s=this.cells.filter((s=>s.x===t.x&&s.y>t.y&&s.y<=t.y+e));this.cells=this.cells.filter((t=>!s.includes(t)))}}this.defineNeighboors(),this.cells[this.cells.indexOf(t)]=t}}defineNeighboors(){this.cells.forEach((t=>{t.neighboor.top=t.y>=1?this.cells.filter((e=>e.x<=t.x&&e.x+e.width>t.x&&e.y===t.y-t.height))[0]:null,t.neighboor.bottom=t.y<=this.rows-1?this.cells.filter((e=>e.x<=t.x&&e.x+e.width>t.x&&e.y===t.y+t.height))[0]:null,t.neighboor.left=t.x>=1?this.cells.filter((e=>e.y<=t.y&&e.y+e.height>t.y&&e.x===t.x-t.width))[0]:null,t.neighboor.right=t.x<=this.cols-1?this.cells.filter((e=>e.y<=t.y&&e.y+e.height>t.y&&e.x===t.x+t.width))[0]:null}))}},t.Interface=Q,t.OffscreenRenderer=M,t.Particle=q,t.ParticuleGenerator=class{constructor(t,e,i,n){this.pos=e,this.lifeDuration=i,this.particles=[],this.UUID=100*s.randint(1,100);for(let s=0;s<t;s++){let t=new q(this.UUID+s,this.pos);this.particles.push(t)}new A(this.lifeDuration,(()=>{this.destroy(),n&&n()}))}addParticles(t){return t.concat(this.particles)}removeParticles(t){const e=this.particles.length;return t.filter((t=>!r(t.id,this.UUID,this.UUID+e)))}destroy(){}},t.PlayerObject=class extends D{constructor(t,e){super(t,e)}update(...t){}render(...t){}},t.Point=n,t.Random=s,t.Renderer=K,t.Texture=class{constructor(t,e){if(!t)throw new Error("A source path to the resource must be provided");this.id=z++,this.image=new Image,this.image.src=t,this.size=new i(this.image.width,this.image.height),this.options=e||{},this.rotation=this.options.rotation||0,this.offset=this.options.offset||a,this.scale=this.options.scale||o}async convertToBitmap(){if(!this.image.width||!this.image.height)return;const t=await createImageBitmap(this.image);return __spreadProps(__spreadValues({},this),{image:t})}},t.VERSION="0.4.3",t.V_NULL=a,t.V_UNIT=o,t.Vector2=i,t.clamp=l,t.createCanvas=Z,t.getWindowDimensions=x,t.inRange=r,Object.defineProperty(t,"__esModule",{value:!0}),t[Symbol.toStringTag]="Module"}));
