var t=Object.assign;class e{static random(){return Math.random()}static randint(t,e){return Math.floor(t+Math.random()*(e-t))}static choice(t){return t[~~(e.random()*t.length)]}static bool(){return e.random()>.5}static sign(){return e.choice([-1,1])}static percent(t){return e.random()<t/100}}var s=e;class i{constructor(t,e){this.x=t,this.y=e}clone(){return new i(this.x,this.y)}add(t){return new i(this.x+t.x,this.y+t.y)}multiply(t){return new i(this.x*t,this.y*t)}dot(t){return this.x*t.x+this.y*t.y}dist(t){return Math.sqrt((this.x-t.x)**2+(this.y-t.y)**2)}}const n=i,l=new i(0,0),a=new i(1,1);function o(t,e,s){return t>s?o(s,e,t):Math.max(t,Math.min(e,s))}function d(t,e,s){return o(e,t,s)===t}class c{constructor(t,e,s,i){this.x=t,this.y=e,this.width=s,this.height=i}}function h(){return{width:window.innerWidth,height:window.innerHeight}}function r(t){return{width:t.clientWidth||t.width,height:t.clientHeight||t.height}}function u(t,e,s,i){t.width=e*(i||window.devicePixelRatio||1),t.height=s*(i||window.devicePixelRatio||1),t.style.width=e+"px",t.style.height=s+"px"}function m(t,e,s,i){const n=document.createElement("canvas");return p(n,t,e,s),i&&(n.oncontextmenu=t=>t.preventDefault()),n}function p(t,e,s,i){const n=i||window.devicePixelRatio||1;u(t,e||r(t).width,s||r(t).height,n),1!=n&&t.getContext("2d").setTransform(n,0,0,n,0,0)}function b(t,e){window.addEventListener("DOMContentLoaded",(()=>{var s;const i=null!=(s=document.querySelector(e))?s:document.createElement(e);i.appendChild(t),document.querySelector("body").appendChild(i)}))}function y(t,e,s=300){var i;null==(i=document.querySelector(t))||i.classList.toggle(e),setTimeout((()=>{var s;return null==(s=document.querySelector(t))?void 0:s.classList.toggle(e)}),s)}function G(){return null==self.document&&null==self.window}function Z(t){let e="";for(const s in t)e+=`#${s}:${t[s]}`;return e}function x(){return performance.now()||Date.now()}function f(t){return window&&t in window}function W(){return/complete|interactive|loaded/.test(document.readyState)&&window.unrailEngineLoaded}var L,g;(g=L||(L={}))[g.KeyboardPressed=0]="KeyboardPressed",g[g.KeyboardDown=1]="KeyboardDown",g[g.Mouse=2]="Mouse",g[g.Window=3]="Window",g[g.Custom=4]="Custom",g[g.All=5]="All";class R{constructor(t,e,s=4){this.name=t,this.callback=e,this.type=s,this.listeners=[this.callback]}static emit(t,e){t instanceof Array?t.forEach((t=>this.emitEvent(t,e))):this.emitEvent(t,e)}static emitEvent(t,e){const s=S.getCustomEvent(t);s&&s.listeners.forEach((t=>t(e)))}static on(t,e){t instanceof Array?t.forEach((t=>this.onEvent(t,e))):this.onEvent(t,e)}static onEvent(t,e){const s=S.getCustomEvent(t);if(s)s.listeners.push(e);else{const s=new R(t,e,4);S.addEvent(s)}}static onKeyDown(t,e){t instanceof Array?t.forEach((t=>S.addEvent(new R(t,e,1)))):S.addEvent(new R(t,e,1))}static onKeyPressed(t,e){t instanceof Array?t.forEach((t=>S.addEvent(new R(t,e,0)))):S.addEvent(new R(t,e,0))}static onAnyKeyReleased(t){S.addEvent(new R("keyup",t,3))}static onClick(t){R.onMouseClick(t)}static onMouseClick(t){S.addEvent(new R("click",t,2))}static onMouseMove(t){S.addEvent(new R("mousemove",t,2))}}const S=new class{constructor(){this.windowEvents=[],this.customEvents=[],this.mouseEvents=[],this.keyboardEvents=[],this.currentKeyEvents=[]}init(){window.addEventListener("keydown",(t=>{this.currentKeyEvents.find((e=>e.code===t.code))||this.currentKeyEvents.push(t),this.keyboardEvents.filter((t=>t.type===L.KeyboardPressed)).forEach((e=>{t.code===e.name&&e.callback(t)}))})),window.addEventListener("keyup",(t=>{this.currentKeyEvents.length&&(this.currentKeyEvents=this.currentKeyEvents.filter((e=>e.code!==t.code)))})),this.bindEvents()}addEvent(t){switch(t.type){case L.KeyboardDown:case L.KeyboardPressed:this.keyboardEvents.push(t);break;case L.Mouse:this.mouseEvents.push(t),window.addEventListener(t.name,(e=>t.callback(e)));break;case L.Window:this.windowEvents.push(t),this.bindEvents();break;case L.Custom:this.customEvents.push(t)}}getCustomEvent(t){return this.customEvents.find((e=>e.name===t))}bindEvents(){this.windowEvents.forEach((t=>window.addEventListener(t.name,t.callback)))}tick(){this.currentKeyEvents.length&&this.keyboardEvents.filter((t=>t.type===L.KeyboardDown)).forEach((t=>{this.currentKeyEvents.forEach((e=>{e.code===t.name&&t.callback(e)}))}))}};const X=new class{constructor(){this.hasStarted=!1,this.animations=[]}add(t){this.animations.push(t),this.hasStarted&&t.options.autostart&&t.start()}init(){this.hasStarted=!0;for(let t of this.animations)t.options.autostart&&t.start()}tick(t){for(let e of this.animations)e.update(t)}};"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var v,w=(function(t,e){var s;t.exports=((s=function(){function t(t){return n.appendChild(t.dom),t}function e(t){for(var e=0;e<n.children.length;e++)n.children[e].style.display=e===t?"block":"none";i=t}var i=0,n=document.createElement("div");n.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",n.addEventListener("click",(function(t){t.preventDefault(),e(++i%n.children.length)}),!1);var l=(performance||Date).now(),a=l,o=0,d=t(new s.Panel("FPS","#0ff","#002")),c=t(new s.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var h=t(new s.Panel("MB","#f08","#201"));return e(0),{REVISION:16,dom:n,addPanel:t,showPanel:e,begin:function(){l=(performance||Date).now()},end:function(){o++;var t=(performance||Date).now();if(c.update(t-l,200),t>a+1e3&&(d.update(1e3*o/(t-a),100),a=t,o=0,h)){var e=performance.memory;h.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){l=this.end()},domElement:n,setMode:e}}).Panel=function(t,e,s){var i=1/0,n=0,l=Math.round,a=l(window.devicePixelRatio||1),o=80*a,d=48*a,c=3*a,h=2*a,r=3*a,u=15*a,m=74*a,p=30*a,b=document.createElement("canvas");b.width=o,b.height=d,b.style.cssText="width:80px;height:48px";var y=b.getContext("2d");return y.font="bold "+9*a+"px Helvetica,Arial,sans-serif",y.textBaseline="top",y.fillStyle=s,y.fillRect(0,0,o,d),y.fillStyle=e,y.fillText(t,c,h),y.fillRect(r,u,m,p),y.fillStyle=s,y.globalAlpha=.9,y.fillRect(r,u,m,p),{dom:b,update:function(d,G){i=Math.min(i,d),n=Math.max(n,d),y.fillStyle=s,y.globalAlpha=1,y.fillRect(0,0,o,u),y.fillStyle=e,y.fillText(l(d)+" "+t+" ("+l(i)+"-"+l(n)+")",c,h),y.drawImage(b,r+a,u,m-a,p,r,u,m-a,p),y.fillRect(r+m-a,u,a,p),y.fillStyle=s,y.globalAlpha=.9,y.fillRect(r+m-a,u,a,l((1-d/G)*p))}}},s)}(v={exports:{}},v.exports),v.exports);let C=0;class V{constructor(t,e){if(this.isLoaded=!1,!t)throw new Error("A source path to the resource must be provided");this.id=C++,this.image=new Image,this.image.src=t,this.image.onload=()=>{this.isLoaded=!0,this.onLoad()},this.size={width:this.image.width,height:this.image.height},this.rotation=(null==e?void 0:e.rotation)||0,this.offset=(null==e?void 0:e.offset)||l,this.scale=(null==e?void 0:e.scale)||a}async convertToBitmap(){if(!this.image.width||!this.image.height)return;const e=await createImageBitmap(this.image);return t(t({},this),{image:e})}onLoad(){}}let k=[],H=4;const K=["top-left","top-right","bottom-left","bottom-right","custom"];class Y{static addItem(t,e,s){Y.internalAddItem(t,e,s)}static addButton(t,e,s,i){Y.internalAddItem(t,s,i,e)}static internalAddItem(t,e,s,i){const n={callback:"string"==typeof t?()=>t:t,position:e,options:s,onClick:i};k.push(n);const l=k.length;W()?Y.addToDom(n,l):R.on("EngineLoaded",(()=>Y.addToDom(n,l)))}static init(){Y.addStyle('*,\n*::after,\n*::before {\n    box-sizing: border-box;\n}\n\nbody {\n    margin: 0;\n    font-family: "Roboto";\n    font-weight: 400;\n    width: 100vw;\n    height: 100vh;\n    overflow: hidden;\n}\n\ncanvas {\n    z-index: 10;\n    image-rendering: pixelated;\n}\n\n.ue-interface {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    display: flex;\n    padding: 0.5em;\n    z-index: 10;\n    /* Make the click event pass through */\n    pointer-events: none;\n}\n\n.ue-container>div {\n    position: absolute;\n    display: flex;\n    flex-flow: column nowrap;\n}\n\n.ue-container>.top-left {\n    top: 0;\n    left: 0;\n}\n\n.ue-container>.top-right {\n    top: 0;\n    right: 0;\n    text-align: right;\n}\n\n.ue-container>.bottom-left {\n    bottom: 0;\n    left: 0;\n}\n\n.ue-container>.bottom-right {\n    bottom: 0;\n    right: 0;\n    text-align: right;\n}\n\n.ue-interface-items {\n    padding: .1em;\n}\n\n.ue-interface-button {\n    cursor: pointer;\n    user-select: none;\n    pointer-events: all;\n}');const t=document.createElement("div");t.classList.add("ue-interface","ue-container");for(let e of K){const s=document.createElement("div");s.classList.add(e),t.appendChild(s)}document.body.appendChild(t)}static addStyle(t){const e=document.createElement("style");e.textContent=t,document.head.append(e)}static addToDom(t,e){var s,i;const n=t.callback(),l=document.createElement("span");l.classList.add("ue-interface-items"),l.id=`item-${e}`,l.innerText=n,Object.entries(t.options||{}).forEach((([t,e])=>l.style[t]=e)),t.position?null==(s=document.querySelector(`.ue-container > .${t.position}`))||s.appendChild(l):null==(i=document.querySelector(".ue-container > .custom"))||i.appendChild(l),t.onClick&&(l.addEventListener("click",(e=>t.onClick(e))),l.classList.add("ue-interface-button"))}static update(){k.forEach(((t,e)=>{const s=t.callback(),i=document.querySelector(`.ue-interface #item-${e+1}`);i&&i.innerText!==s&&(i.innerText=s)}))}static statsShift(t){const e=document.querySelector(".top-left");e&&(e.style.top=`${t}px`)}static setUpdateInterval(t){H=t}static get updateInterval(){return H}static getItems(){return k}}String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};class I extends Error{constructor(t,e){super(e?`[${e.capitalize()}] - ${t}`:t),this.name="EngineFailure"}}class N extends I{constructor(t){super(t,"renderer")}}class z{constructor(t,e,s){this.spriteSheetPath=t,this.cols=e,this.rows=s}}const M={interval:200,loop:!1};class F extends V{constructor(e,s,i,n){if(super(e.spriteSheetPath),this.intervalId=-1,this.isAnimated=!1,this.lastRunTimeStamp=0,this.spriteSheet=e,s[0]<1||s[1]<1||i[0]<1||i[1]<1||s[0]>e.cols||s[1]>e.rows||i[0]>e.cols||i[1]>e.rows)throw new I("Invalid tuples : the spritesheet coordinate starts at (1, 1)");this.from=s,this.to=i;let l=t(t({},M),n);this.interval=l.interval,this.loop=l.loop,this.spriteWidth=this.size.width/e.cols,this.spriteHeight=this.size.height/e.rows,this.coordX=this.from[0],this.coordY=this.from[1]}run(){let t=x();t-this.lastRunTimeStamp>this.interval&&(this.step(),this.lastRunTimeStamp=t)}animate(){this.isAnimated||(this.intervalId=window.setInterval((()=>this.step()),this.interval),this.isAnimated=!0)}pause(){this.isAnimated&&(window.clearInterval(this.intervalId),this.isAnimated=!1)}reset(){this.coordX=this.from[0],this.coordY=this.from[1]}stop(){this.pause(),this.reset()}setInterval(t){this.interval=t,this.isAnimated&&(window.clearInterval(this.intervalId),this.animate())}step(){this.coordX!==this.to[0]||this.coordY!==this.to[1]?this.coordY<this.to[1]?this.coordX<this.spriteSheet.cols?this.coordX++:(this.coordY++,this.coordX=this.from[0]):this.coordX<this.to[0]&&this.coordX++:this.loop&&(this.coordX=this.from[0],this.coordY=this.from[1])}spriteBox(){return new c((this.coordX-1)*this.spriteWidth,(this.coordY-1)*this.spriteHeight,this.spriteWidth,this.spriteHeight)}}const U={strokeStyle:"black",lineWidth:2,lineJoin:"round",lineCap:"round",fillStyle:"transparent",globalAlpha:1,globalCompositeOperation:"add"},J={font:"Roboto",size:16,color:"black",textAlign:"left",textBaseline:"alphabetic"},E=2*Math.PI;let T,j,Q,P,B,D=G()?4:2*(window.devicePixelRatio||1),O=l;function A(t){return~~(t*D)/D}class q{static create(t,e){let[s,i]=[h().width,h().height];const n=m(t||s,e||i);return b(n,"main"),q.setContext(n.getContext("2d")),n}static createFromCanvas(t){let e=document.querySelector(t);if(!(e&&e instanceof HTMLCanvasElement))throw new N("The selected element is not a canvas");return p(e),q.setContext(e.getContext("2d")),e}static setContext(t){T=t}static getContext(){return T}static setOffset(t,e){O=new i(t,e)}static getOffset(){return O}static style(e){if(!T)throw new N("Context has not been initialize. Please use Renderer.setContext");const s=t(t({},U),e);if(s!==j){"color"in s&&(s.fillStyle=s.color,s.strokeStyle=s.color,delete s.color);for(let t in s)T[t]!==s[t]&&(T[t]=s[t]);j=s}}static textStyle(e){if(T){let s=t(t({},J),e);T.font=`${s.size}px ${s.font}`,delete s.size,delete s.font,q.style(t({fillStyle:s.color},s))}}static clear(t){t?(q.style({fillStyle:t}),T.fillRect(0,0,T.canvas.width,T.canvas.height)):T.clearRect(0,0,T.canvas.width,T.canvas.height)}static line(t,e,s,i,n){q.style(n),T.beginPath(),T.moveTo(A(O.x+t),A(O.y+e)),T.lineTo(A(O.x+s),A(O.y+i)),T.stroke()}static rect(t,e,s,i,n){q.style(n);const[l,a,o,d]=[A(t+O.x),A(e+O.y),A(s),A(i)];T.fillRect(l,a,o,d),T.strokeRect(l,a,o,d)}static rectFromCenter(t,e,s,i,n){return q.rect(t-s/2,e-i/2,s,i,n)}static rectFromPoints(t,e,s,i,n){return q.rect(t,e,s-t,i-e,n)}static poly(t,e){if(t.length){q.style(e),T.beginPath(),T.moveTo(A(t[0].x+O.x),A(t[0].y+O.y));for(let e=1;e<t.length;e++)T.lineTo(A(t[e].x+O.x),A(t[e].y+O.y));T.stroke()}}static circle(t,e,s,i){q.style(i),T.beginPath(),T.arc(A(t+O.x),A(e+O.y),s,0,E),T.fill(),T.stroke()}static circleFromRect(t,e,s,i,n){return q.circle(t+s/2,e+i/2,Math.min(s,i)/2,n)}static point(t,e,s){q.circle(t,e,5,s)}static rectSprite(t,e,s,i,n){if(!n.isLoaded)return;q.style({}),T.save(),T.translate(A(t+s/2+O.x),A(e+i/2+O.y)),T.scale(n.scale.x,n.scale.y),T.rotate(n.rotation);let l=new c(0,0,n.size.width,n.size.height);n instanceof F&&(l=n.spriteBox()),T.drawImage(n.image,l.x,l.y,l.width,l.height,A(s*n.offset.x-s/2),A(i*n.offset.y-i/2),A(s),A(i)),T.restore()}static circleSprite(t,e,s,i){i.isLoaded&&(T.save(),T.beginPath(),T.arc(A(t+O.x),A(e+O.y),s,0,E),T.clip(),q.rectSprite(t-s,e-s,2*s,2*s,i),T.restore())}static text(t,e,s,i){q.textStyle(i),T.fillText(t,e,s)}static centeredText(e,s,i,n){q.text(e,s,i,t(t({},n),{textAlign:"center",textBaseline:"middle"}))}static tint(t,e,s,i,n){q.rect(e,s,i,n,{fillStyle:t,globalCompositeOperation:"multiply",globalAlpha:.25})}static beginFrame(t){q.clear(t)}static endFrame(){}}class ${constructor(t,e){this.title=t,this.content=e}}class _{constructor(t,e){this.methodName=t,this.args=e}}function tt(){return new Worker("data:application/javascript;base64,dmFyIHQ9T2JqZWN0LmFzc2lnbjtjbGFzcyBle2NvbnN0cnVjdG9yKHQsZSxpLHMpe3RoaXMueD10LHRoaXMueT1lLHRoaXMud2lkdGg9aSx0aGlzLmhlaWdodD1zfX1mdW5jdGlvbiBpKCl7cmV0dXJue3dpZHRoOndpbmRvdy5pbm5lcldpZHRoLGhlaWdodDp3aW5kb3cuaW5uZXJIZWlnaHR9fWZ1bmN0aW9uIHModCl7cmV0dXJue3dpZHRoOnQuY2xpZW50V2lkdGh8fHQud2lkdGgsaGVpZ2h0OnQuY2xpZW50SGVpZ2h0fHx0LmhlaWdodH19ZnVuY3Rpb24gcih0LGUsaSxyKXtjb25zdCBvPXJ8fHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvfHwxOyFmdW5jdGlvbih0LGUsaSxzKXt0LndpZHRoPWUqKHN8fHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvfHwxKSx0LmhlaWdodD1pKihzfHx3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpb3x8MSksdC5zdHlsZS53aWR0aD1lKyJweCIsdC5zdHlsZS5oZWlnaHQ9aSsicHgifSh0LGV8fHModCkud2lkdGgsaXx8cyh0KS5oZWlnaHQsbyksMSE9byYmdC5nZXRDb250ZXh0KCIyZCIpLnNldFRyYW5zZm9ybShvLDAsMCxvLDAsMCl9Y2xhc3Mgb3tjb25zdHJ1Y3Rvcih0LGUpe3RoaXMueD10LHRoaXMueT1lfWNsb25lKCl7cmV0dXJuIG5ldyBvKHRoaXMueCx0aGlzLnkpfWFkZCh0KXtyZXR1cm4gbmV3IG8odGhpcy54K3QueCx0aGlzLnkrdC55KX1tdWx0aXBseSh0KXtyZXR1cm4gbmV3IG8odGhpcy54KnQsdGhpcy55KnQpfWRvdCh0KXtyZXR1cm4gdGhpcy54KnQueCt0aGlzLnkqdC55fWRpc3QodCl7cmV0dXJuIE1hdGguc3FydCgodGhpcy54LXQueCkqKjIrKHRoaXMueS10LnkpKioyKX19Y29uc3Qgbj1uZXcgbygwLDApLGE9bmV3IG8oMSwxKTtTdHJpbmcucHJvdG90eXBlLmNhcGl0YWxpemU9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSt0aGlzLnNsaWNlKDEpfTtjbGFzcyBjIGV4dGVuZHMgRXJyb3J7Y29uc3RydWN0b3IodCxlKXtzdXBlcihlP2BbJHtlLmNhcGl0YWxpemUoKX1dIC0gJHt0fWA6dCksdGhpcy5uYW1lPSJFbmdpbmVGYWlsdXJlIn19Y2xhc3MgaCBleHRlbmRzIGN7Y29uc3RydWN0b3IodCl7c3VwZXIodCwicmVuZGVyZXIiKX19bGV0IGw9MDtjb25zdCBkPXtpbnRlcnZhbDoyMDAsbG9vcDohMX07Y29uc3QgdT17c3Ryb2tlU3R5bGU6ImJsYWNrIixsaW5lV2lkdGg6MixsaW5lSm9pbjoicm91bmQiLGxpbmVDYXA6InJvdW5kIixmaWxsU3R5bGU6InRyYW5zcGFyZW50IixnbG9iYWxBbHBoYToxLGdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbjoiYWRkIn0seD17Zm9udDoiUm9ib3RvIixzaXplOjE2LGNvbG9yOiJibGFjayIsdGV4dEFsaWduOiJsZWZ0Iix0ZXh0QmFzZWxpbmU6ImFscGhhYmV0aWMifSxmPTIqTWF0aC5QSTtsZXQgbSxwLGc9bnVsbD09c2VsZi5kb2N1bWVudCYmbnVsbD09c2VsZi53aW5kb3c/NDoyKih3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpb3x8MSksdz1uO2Z1bmN0aW9uIHkodCl7cmV0dXJufn4odCpnKS9nfWNsYXNzIHZ7c3RhdGljIGNyZWF0ZSh0LGUpe2xldFtzLG9dPVtpKCkud2lkdGgsaSgpLmhlaWdodF07Y29uc3Qgbj1mdW5jdGlvbih0LGUsaSxzKXtjb25zdCBvPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImNhbnZhcyIpO3JldHVybiByKG8sdCxlLGkpLHMmJihvLm9uY29udGV4dG1lbnU9dD0+dC5wcmV2ZW50RGVmYXVsdCgpKSxvfSh0fHxzLGV8fG8pO3JldHVybiBmdW5jdGlvbih0LGUpe3dpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIiwoKCk9Pnt2YXIgaTtjb25zdCBzPW51bGwhPShpPWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZSkpP2k6ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChlKTtzLmFwcGVuZENoaWxkKHQpLGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoImJvZHkiKS5hcHBlbmRDaGlsZChzKX0pKX0obiwibWFpbiIpLHYuc2V0Q29udGV4dChuLmdldENvbnRleHQoIjJkIikpLG59c3RhdGljIGNyZWF0ZUZyb21DYW52YXModCl7bGV0IGU9ZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0KTtpZighKGUmJmUgaW5zdGFuY2VvZiBIVE1MQ2FudmFzRWxlbWVudCkpdGhyb3cgbmV3IGgoIlRoZSBzZWxlY3RlZCBlbGVtZW50IGlzIG5vdCBhIGNhbnZhcyIpO3JldHVybiByKGUpLHYuc2V0Q29udGV4dChlLmdldENvbnRleHQoIjJkIikpLGV9c3RhdGljIHNldENvbnRleHQodCl7bT10fXN0YXRpYyBnZXRDb250ZXh0KCl7cmV0dXJuIG19c3RhdGljIHNldE9mZnNldCh0LGUpe3c9bmV3IG8odCxlKX1zdGF0aWMgZ2V0T2Zmc2V0KCl7cmV0dXJuIHd9c3RhdGljIHN0eWxlKGUpe2lmKCFtKXRocm93IG5ldyBoKCJDb250ZXh0IGhhcyBub3QgYmVlbiBpbml0aWFsaXplLiBQbGVhc2UgdXNlIFJlbmRlcmVyLnNldENvbnRleHQiKTtjb25zdCBpPXQodCh7fSx1KSxlKTtpZihpIT09cCl7ImNvbG9yImluIGkmJihpLmZpbGxTdHlsZT1pLmNvbG9yLGkuc3Ryb2tlU3R5bGU9aS5jb2xvcixkZWxldGUgaS5jb2xvcik7Zm9yKGxldCB0IGluIGkpbVt0XSE9PWlbdF0mJihtW3RdPWlbdF0pO3A9aX19c3RhdGljIHRleHRTdHlsZShlKXtpZihtKXtsZXQgaT10KHQoe30seCksZSk7bS5mb250PWAke2kuc2l6ZX1weCAke2kuZm9udH1gLGRlbGV0ZSBpLnNpemUsZGVsZXRlIGkuZm9udCx2LnN0eWxlKHQoe2ZpbGxTdHlsZTppLmNvbG9yfSxpKSl9fXN0YXRpYyBjbGVhcih0KXt0Pyh2LnN0eWxlKHtmaWxsU3R5bGU6dH0pLG0uZmlsbFJlY3QoMCwwLG0uY2FudmFzLndpZHRoLG0uY2FudmFzLmhlaWdodCkpOm0uY2xlYXJSZWN0KDAsMCxtLmNhbnZhcy53aWR0aCxtLmNhbnZhcy5oZWlnaHQpfXN0YXRpYyBsaW5lKHQsZSxpLHMscil7di5zdHlsZShyKSxtLmJlZ2luUGF0aCgpLG0ubW92ZVRvKHkody54K3QpLHkody55K2UpKSxtLmxpbmVUbyh5KHcueCtpKSx5KHcueStzKSksbS5zdHJva2UoKX1zdGF0aWMgcmVjdCh0LGUsaSxzLHIpe3Yuc3R5bGUocik7Y29uc3RbbyxuLGEsY109W3kodCt3LngpLHkoZSt3LnkpLHkoaSkseShzKV07bS5maWxsUmVjdChvLG4sYSxjKSxtLnN0cm9rZVJlY3QobyxuLGEsYyl9c3RhdGljIHJlY3RGcm9tQ2VudGVyKHQsZSxpLHMscil7cmV0dXJuIHYucmVjdCh0LWkvMixlLXMvMixpLHMscil9c3RhdGljIHJlY3RGcm9tUG9pbnRzKHQsZSxpLHMscil7cmV0dXJuIHYucmVjdCh0LGUsaS10LHMtZSxyKX1zdGF0aWMgcG9seSh0LGUpe2lmKHQubGVuZ3RoKXt2LnN0eWxlKGUpLG0uYmVnaW5QYXRoKCksbS5tb3ZlVG8oeSh0WzBdLngrdy54KSx5KHRbMF0ueSt3LnkpKTtmb3IobGV0IGU9MTtlPHQubGVuZ3RoO2UrKyltLmxpbmVUbyh5KHRbZV0ueCt3LngpLHkodFtlXS55K3cueSkpO20uc3Ryb2tlKCl9fXN0YXRpYyBjaXJjbGUodCxlLGkscyl7di5zdHlsZShzKSxtLmJlZ2luUGF0aCgpLG0uYXJjKHkodCt3LngpLHkoZSt3LnkpLGksMCxmKSxtLmZpbGwoKSxtLnN0cm9rZSgpfXN0YXRpYyBjaXJjbGVGcm9tUmVjdCh0LGUsaSxzLHIpe3JldHVybiB2LmNpcmNsZSh0K2kvMixlK3MvMixNYXRoLm1pbihpLHMpLzIscil9c3RhdGljIHBvaW50KHQsZSxpKXt2LmNpcmNsZSh0LGUsNSxpKX1zdGF0aWMgcmVjdFNwcml0ZShpLHMscixvLGgpe2lmKCFoLmlzTG9hZGVkKXJldHVybjt2LnN0eWxlKHt9KSxtLnNhdmUoKSxtLnRyYW5zbGF0ZSh5KGkrci8yK3cueCkseShzK28vMit3LnkpKSxtLnNjYWxlKGguc2NhbGUueCxoLnNjYWxlLnkpLG0ucm90YXRlKGgucm90YXRpb24pO2xldCB1PW5ldyBlKDAsMCxoLnNpemUud2lkdGgsaC5zaXplLmhlaWdodCk7aCBpbnN0YW5jZW9mIGNsYXNzIGV4dGVuZHMgY2xhc3N7Y29uc3RydWN0b3IodCxlKXtpZih0aGlzLmlzTG9hZGVkPSExLCF0KXRocm93IG5ldyBFcnJvcigiQSBzb3VyY2UgcGF0aCB0byB0aGUgcmVzb3VyY2UgbXVzdCBiZSBwcm92aWRlZCIpO3RoaXMuaWQ9bCsrLHRoaXMuaW1hZ2U9bmV3IEltYWdlLHRoaXMuaW1hZ2Uuc3JjPXQsdGhpcy5pbWFnZS5vbmxvYWQ9KCk9Pnt0aGlzLmlzTG9hZGVkPSEwLHRoaXMub25Mb2FkKCl9LHRoaXMuc2l6ZT17d2lkdGg6dGhpcy5pbWFnZS53aWR0aCxoZWlnaHQ6dGhpcy5pbWFnZS5oZWlnaHR9LHRoaXMucm90YXRpb249KG51bGw9PWU/dm9pZCAwOmUucm90YXRpb24pfHwwLHRoaXMub2Zmc2V0PShudWxsPT1lP3ZvaWQgMDplLm9mZnNldCl8fG4sdGhpcy5zY2FsZT0obnVsbD09ZT92b2lkIDA6ZS5zY2FsZSl8fGF9YXN5bmMgY29udmVydFRvQml0bWFwKCl7aWYoIXRoaXMuaW1hZ2Uud2lkdGh8fCF0aGlzLmltYWdlLmhlaWdodClyZXR1cm47Y29uc3QgZT1hd2FpdCBjcmVhdGVJbWFnZUJpdG1hcCh0aGlzLmltYWdlKTtyZXR1cm4gdCh0KHt9LHRoaXMpLHtpbWFnZTplfSl9b25Mb2FkKCl7fX17Y29uc3RydWN0b3IoZSxpLHMscil7aWYoc3VwZXIoZS5zcHJpdGVTaGVldFBhdGgpLHRoaXMuaW50ZXJ2YWxJZD0tMSx0aGlzLmlzQW5pbWF0ZWQ9ITEsdGhpcy5sYXN0UnVuVGltZVN0YW1wPTAsdGhpcy5zcHJpdGVTaGVldD1lLGlbMF08MXx8aVsxXTwxfHxzWzBdPDF8fHNbMV08MXx8aVswXT5lLmNvbHN8fGlbMV0+ZS5yb3dzfHxzWzBdPmUuY29sc3x8c1sxXT5lLnJvd3MpdGhyb3cgbmV3IGMoIkludmFsaWQgdHVwbGVzIDogdGhlIHNwcml0ZXNoZWV0IGNvb3JkaW5hdGUgc3RhcnRzIGF0ICgxLCAxKSIpO3RoaXMuZnJvbT1pLHRoaXMudG89cztsZXQgbz10KHQoe30sZCkscik7dGhpcy5pbnRlcnZhbD1vLmludGVydmFsLHRoaXMubG9vcD1vLmxvb3AsdGhpcy5zcHJpdGVXaWR0aD10aGlzLnNpemUud2lkdGgvZS5jb2xzLHRoaXMuc3ByaXRlSGVpZ2h0PXRoaXMuc2l6ZS5oZWlnaHQvZS5yb3dzLHRoaXMuY29vcmRYPXRoaXMuZnJvbVswXSx0aGlzLmNvb3JkWT10aGlzLmZyb21bMV19cnVuKCl7bGV0IHQ9cGVyZm9ybWFuY2Uubm93KCl8fERhdGUubm93KCk7dC10aGlzLmxhc3RSdW5UaW1lU3RhbXA+dGhpcy5pbnRlcnZhbCYmKHRoaXMuc3RlcCgpLHRoaXMubGFzdFJ1blRpbWVTdGFtcD10KX1hbmltYXRlKCl7dGhpcy5pc0FuaW1hdGVkfHwodGhpcy5pbnRlcnZhbElkPXdpbmRvdy5zZXRJbnRlcnZhbCgoKCk9PnRoaXMuc3RlcCgpKSx0aGlzLmludGVydmFsKSx0aGlzLmlzQW5pbWF0ZWQ9ITApfXBhdXNlKCl7dGhpcy5pc0FuaW1hdGVkJiYod2luZG93LmNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbElkKSx0aGlzLmlzQW5pbWF0ZWQ9ITEpfXJlc2V0KCl7dGhpcy5jb29yZFg9dGhpcy5mcm9tWzBdLHRoaXMuY29vcmRZPXRoaXMuZnJvbVsxXX1zdG9wKCl7dGhpcy5wYXVzZSgpLHRoaXMucmVzZXQoKX1zZXRJbnRlcnZhbCh0KXt0aGlzLmludGVydmFsPXQsdGhpcy5pc0FuaW1hdGVkJiYod2luZG93LmNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbElkKSx0aGlzLmFuaW1hdGUoKSl9c3RlcCgpe3RoaXMuY29vcmRYIT09dGhpcy50b1swXXx8dGhpcy5jb29yZFkhPT10aGlzLnRvWzFdP3RoaXMuY29vcmRZPHRoaXMudG9bMV0/dGhpcy5jb29yZFg8dGhpcy5zcHJpdGVTaGVldC5jb2xzP3RoaXMuY29vcmRYKys6KHRoaXMuY29vcmRZKyssdGhpcy5jb29yZFg9dGhpcy5mcm9tWzBdKTp0aGlzLmNvb3JkWDx0aGlzLnRvWzBdJiZ0aGlzLmNvb3JkWCsrOnRoaXMubG9vcCYmKHRoaXMuY29vcmRYPXRoaXMuZnJvbVswXSx0aGlzLmNvb3JkWT10aGlzLmZyb21bMV0pfXNwcml0ZUJveCgpe3JldHVybiBuZXcgZSgodGhpcy5jb29yZFgtMSkqdGhpcy5zcHJpdGVXaWR0aCwodGhpcy5jb29yZFktMSkqdGhpcy5zcHJpdGVIZWlnaHQsdGhpcy5zcHJpdGVXaWR0aCx0aGlzLnNwcml0ZUhlaWdodCl9fSYmKHU9aC5zcHJpdGVCb3goKSksbS5kcmF3SW1hZ2UoaC5pbWFnZSx1LngsdS55LHUud2lkdGgsdS5oZWlnaHQseShyKmgub2Zmc2V0Lngtci8yKSx5KG8qaC5vZmZzZXQueS1vLzIpLHkocikseShvKSksbS5yZXN0b3JlKCl9c3RhdGljIGNpcmNsZVNwcml0ZSh0LGUsaSxzKXtzLmlzTG9hZGVkJiYobS5zYXZlKCksbS5iZWdpblBhdGgoKSxtLmFyYyh5KHQrdy54KSx5KGUrdy55KSxpLDAsZiksbS5jbGlwKCksdi5yZWN0U3ByaXRlKHQtaSxlLWksMippLDIqaSxzKSxtLnJlc3RvcmUoKSl9c3RhdGljIHRleHQodCxlLGkscyl7di50ZXh0U3R5bGUocyksbS5maWxsVGV4dCh0LGUsaSl9c3RhdGljIGNlbnRlcmVkVGV4dChlLGkscyxyKXt2LnRleHQoZSxpLHMsdCh0KHt9LHIpLHt0ZXh0QWxpZ246ImNlbnRlciIsdGV4dEJhc2VsaW5lOiJtaWRkbGUifSkpfXN0YXRpYyB0aW50KHQsZSxpLHMscil7di5yZWN0KGUsaSxzLHIse2ZpbGxTdHlsZTp0LGdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbjoibXVsdGlwbHkiLGdsb2JhbEFscGhhOi4yNX0pfXN0YXRpYyBiZWdpbkZyYW1lKHQpe3YuY2xlYXIodCl9c3RhdGljIGVuZEZyYW1lKCl7fX1uZXcgY2xhc3MgZXh0ZW5kcyBjbGFzc3tzZW5kTWVzc2FnZVRvTWFpblRocmVhZCh0LGUpe3NlbGYucG9zdE1lc3NhZ2Uoe3RpdGxlOnQsZGF0YTplfSl9bG9nKC4uLnQpe3RoaXMuc2VuZE1lc3NhZ2VUb01haW5UaHJlYWQoImxvZyIsLi4udCl9fXtjb25zdHJ1Y3Rvcigpe3N1cGVyKCksdGhpcy5jYW52YXNSZXNvbHV0aW9uPTEsdGhpcy5vZmZzY3JlZW5DYW52YXM9bnVsbCx0aGlzLmN0eD1udWxsLHRoaXMudGV4dHVyZUFsaWFzPW5ldyBNYXAsc2VsZi5hZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIiwoKHtkYXRhOnR9KT0+dGhpcy5vbk1lc3NhZ2UodC50aXRsZSx0LmNvbnRlbnQpKSl9b25NZXNzYWdlKHQsZSl7c3dpdGNoKHQpe2Nhc2UiaW5pdENhbnZhcyI6dGhpcy5vZmZzY3JlZW5DYW52YXM9ZS5jYW52YXMsdGhpcy5jdHg9dGhpcy5vZmZzY3JlZW5DYW52YXMuZ2V0Q29udGV4dCgiMmQiKSx2LnNldENvbnRleHQodGhpcy5jdHgpLHRoaXMuc2V0U2l6ZShlLmRwcixlLndpZHRoLGUuaGVpZ2h0KSx0aGlzLnNlbmRNZXNzYWdlVG9NYWluVGhyZWFkKCJpbml0aWFsaXplZCIpO2JyZWFrO2Nhc2UicmVuZGVyIjpmb3IobGV0IHQgb2YgZS5yZW5kZXJTdGFjayl0aGlzLmhhbmRsZURyYXdSZXF1ZXN0KHQubWV0aG9kTmFtZSx0LmFyZ3MpO2JyZWFrO2Nhc2UibmV3VGV4dHVyZSI6dGhpcy50ZXh0dXJlQWxpYXMuc2V0KGUuaWQsZS50ZXh0dXJlKX19c2V0U2l6ZSh0LGUsaSl7Y29uc3Qgcz0odHx8MSkqdGhpcy5jYW52YXNSZXNvbHV0aW9uO3RoaXMub2Zmc2NyZWVuQ2FudmFzLndpZHRoPWUqcyx0aGlzLm9mZnNjcmVlbkNhbnZhcy5oZWlnaHQ9aSpzLCJzZXRUcmFuc2Zvcm0iaW4gdGhpcy5jdHgmJnRoaXMuY3R4LnNldFRyYW5zZm9ybShzLDAsMCxzLDAsMCl9Z2V0VGV4dHVyZShlKXtjb25zdCBpPXRoaXMudGV4dHVyZUFsaWFzLmdldChlLnRleHR1cmVJZCkse3NjYWxlOnMscm90YXRpb246cixvZmZzZXQ6b309ZTtyZXR1cm4gdCh0KHt9LGkpLHtzY2FsZTpzLHJvdGF0aW9uOnIsb2Zmc2V0Om99KX1oYW5kbGVEcmF3UmVxdWVzdCh0LGUpe3N3aXRjaCh0KXtjYXNlInN0eWxlIjp2LnN0eWxlKG51bGw9PWU/dm9pZCAwOmUub2JqKTticmVhaztjYXNlImNsZWFyIjp2LmNsZWFyKG51bGw9PWU/dm9pZCAwOmUuY29sb3IpO2JyZWFrO2Nhc2UibGluZSI6di5saW5lKGUueDEsZS55MSxlLngyLGUueTIsZS5vYmopO2JyZWFrO2Nhc2UicmVjdCI6di5yZWN0KGUueCxlLnksZS53aWR0aCxlLmhlaWdodCxlLm9iaik7YnJlYWs7Y2FzZSJyZWN0RnJvbUNlbnRlciI6di5yZWN0RnJvbUNlbnRlcihlLngsZS55LGUud2lkdGgsZS5oZWlnaHQsZS5vYmopO2JyZWFrO2Nhc2UicmVjdEZyb21Qb2ludHMiOnYucmVjdEZyb21Qb2ludHMoZS54MSxlLnkxLGUueDIsZS55MixlLm9iaik7YnJlYWs7Y2FzZSJwb2x5Ijp2LnBvbHkoZS5wb2ludHMsZS5vYmopO2JyZWFrO2Nhc2UiY2lyY2xlIjp2LmNpcmNsZShlLngsZS55LGUucmFkaXVzLGUub2JqKTticmVhaztjYXNlImNpcmNsZUZyb21SZWN0Ijp2LmNpcmNsZUZyb21SZWN0KGUueCxlLnksZS53aWR0aCxlLmhlaWdodCxlLm9iaik7YnJlYWs7Y2FzZSJwb2ludCI6di5wb2ludChlLngsZS55LGUub2JqKTticmVhaztjYXNlInJlY3RTcHJpdGUiOnYucmVjdFNwcml0ZShlLngsZS55LGUud2lkdGgsZS5oZWlnaHQsdGhpcy5nZXRUZXh0dXJlKGUpKTticmVhaztjYXNlImNpcmNsZVNwcml0ZSI6di5jaXJjbGVTcHJpdGUoZS54LGUueSxlLnJhZGl1cyx0aGlzLmdldFRleHR1cmUoZSkpO2JyZWFrO2Nhc2UidGV4dCI6di50ZXh0KGUudGV4dCxlLngsZS55LG51bGw9PWU/dm9pZCAwOmUuc3R5bGUpO2JyZWFrO2Nhc2UiY2VudGVyZWRUZXh0Ijp2LmNlbnRlcmVkVGV4dChlLnRleHQsZS54LGUueSxudWxsPT1lP3ZvaWQgMDplLnN0eWxlKTticmVhaztjYXNlInRpbnQiOnYudGludChlLmNvbG9yLGUueCxlLnksZS53aWR0aCxlLmhlaWdodCl9fX07Cg==",{type:"module"})}let et=!1,st=[];const it=new Map;class nt{static get worker(){return P}static get workerIsInitialized(){return et}static get offscreenCanvas(){return Q}static get renderStack(){return st}static create(t,e){let[s,i]=[h().width,h().height];return B=m(t||s,e||i,1),nt.initRenderWorker(B,t||s,e||i),b(B,"main"),B}static createFromCanvas(t){if(B=document.querySelector(t),!(B&&B instanceof HTMLCanvasElement))throw new N("The selected element is not a canvas");return p(B,B.clientWidth,B.clientHeight,1),nt.initRenderWorker(B,B.width,B.height),B}static initRenderWorker(t,e,s){ct.renderer instanceof nt||ct.setRendererType("offscreen");let{clientWidth:i,clientHeight:n}=t;P=new tt,Q=t.transferControlToOffscreen(),this.sendMessageToWorker("initCanvas",{width:e||i,height:s||n,canvas:Q,dpr:window.devicePixelRatio||1},[Q]),P.onmessage=({data:{title:t,data:e}})=>{switch(t){case"log":console.log("message from the renderer worker : ",e);break;case"initialized":et=!0,this.endFrame();break;default:console.log(t)}}}static addRenderCall(t,e){st.push(new _(t,e||{}))}static sendMessageToWorker(t,e,s){return P.postMessage(new $(t,e),s||[])}static style(t){this.addRenderCall("style",{obj:t})}static clear(t){this.addRenderCall("clear",{color:t})}static line(t,e,s,i,n){this.addRenderCall("line",{x1:t,y1:e,x2:s,y2:i,obj:n})}static rect(t,e,s,i,n){this.addRenderCall("rect",{x:t,y:e,width:s,height:i,obj:n})}static rectFromCenter(t,e,s,i,n){this.addRenderCall("rectFromCenter",{x:t,y:e,width:s,height:i,obj:n})}static rectFromPoints(t,e,s,i,n){this.addRenderCall("rectFromPoints",{x1:t,y1:e,x2:s,y2:i,obj:n})}static poly(t,e){this.addRenderCall("poly",{points:t,obj:e})}static circle(t,e,s,i){this.addRenderCall("circle",{x:t,y:e,radius:s,obj:i})}static circleFromRect(t,e,s,i,n){this.addRenderCall("circleFromRect",{x:t,y:e,width:s,height:i,obj:n})}static point(t,e,s){this.addRenderCall("point",{x:t,y:e,obj:s})}static handleTexture(e,s,i){var n;if(e.isLoaded)if(it.has(e.id)){const{scale:n,rotation:l,offset:a}=e;this.addRenderCall(s,t(t({},i),{textureId:e.id,scale:n,rotation:l,offset:a}))}else null==(n=e.convertToBitmap())||n.then((t=>{it.set(e.id,t),this.sendMessageToWorker("newTexture",{id:e.id,texture:t})}))}static rectSprite(t,e,s,i,n){this.handleTexture(n,"rectSprite",{x:t,y:e,width:s,height:i})}static async circleSprite(t,e,s,i){this.handleTexture(i,"circleSprite",{x:t,y:e,radius:s})}static text(t,e,s,i){this.addRenderCall("text",{text:t,x:e,y:s,style:i})}static centeredText(t,e,s,i){this.addRenderCall("centeredText",{text:t,x:e,y:s,style:i})}static tint(t,e,s,i,n){this.addRenderCall("circle",{color:t,x:e,y:s,width:i,height:n})}static beginFrame(t){st=[],this.clear(t)}static endFrame(){et&&(this.sendMessageToWorker("render",{renderStack:st}),st=[])}}const lt=f("OffscreenCanvas")?nt:q;function at(){const t=new w,e=document.createElement("div");return e.classList.toggle("stats"),t.showPanel(0),e.appendChild(t.dom),document.body.appendChild(e),Y.statsShift(48),t}class ot{constructor(t,e=60){if(this.requestId=0,this.animate=t,this.fps=e,!window)throw new I("No window context","core")}start(){let t=x();const e=1e3/this.fps,s=i=>{this.requestId=window.requestAnimationFrame(s);const n=i-t;n>=e-.1&&(t=i-n%e,this.animate(n))};this.requestId=window.requestAnimationFrame(s)}stop(){window.cancelAnimationFrame(this.requestId)}}let dt="normal";class ct{constructor(t,e,s=60){this.fps=60,this.name=t,this.env=e,this.tick=0,this.stats=null,this.showStatsPanel=!1,this.gameLoop=this.env?()=>e.update():null,this.fps=s,this.makeAnimationFrame()}static setRendererType(t){dt=t}static get renderer(){return"normal"===dt?q:lt}toggleStats(t){this.showStatsPanel=void 0!==t?t:!this.showStatsPanel,this.showStatsPanel?this.stats=at():(this.stats=null,document.querySelector(".stats")&&document.querySelector(".stats").remove())}makeAnimationFrame(){this.update&&(this.animationFrame=new ot((t=>this.update(t)),this.fps))}setMainLoop(t){this.gameLoop=t,this.makeAnimationFrame()}setFPS(t){this.fps=t,this.makeAnimationFrame()}update(t){var e,s;null==(e=this.stats)||e.begin(),S.tick(),X.tick(t),this.gameLoop&&this.gameLoop(t),this.tick%Y.updateInterval==0&&Y.update(),null==(s=this.stats)||s.end(),this.tick++}start(){if(!this.gameLoop)throw new Error("No game loop");if(!this.animationFrame)throw new Error("AnimationFrame");W()?this.internalStart():window.addEventListener("DOMContentLoaded",(()=>this.internalStart()))}internalStart(){this.name&&(document.title=this.name),S.init(),X.init(),Y.init(),this.showStatsPanel&&(this.stats=at()),this.animationFrame.start(),window.unrailEngineLoaded=!0,R.emit("EngineLoaded")}}class ht{constructor(t,e){this.width=t,this.height=e}update(){}render(){}}class rt{constructor(t,e,s,i){this.x=t,this.y=e,this.width=s||100,this.height=i||s||100}collide(t){return!!(t.width&&t.height&&this.width&&this.height)&&(this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.height+this.y>t.y)}update(...t){}render(...t){}}class ut extends rt{constructor(t,e,s,i){super(t,e,s,i)}update(...t){}render(...t){}}class mt{constructor(t,e){this.delay=t,this.callback=e,window.setTimeout(this.callback,this.delay)}}class pt extends rt{constructor(t,e,s=5,n,l){super(e.x,e.y),this.radius=2,this.id=t,this.pos=e.clone(),this.angle=n&&"random"!=n?n%2*Math.PI:Math.PI/2+2*Math.random()*Math.PI,this.velocity=new i(Math.random()*s*Math.cos(this.angle),Math.random()*s*Math.sin(this.angle)),this.color=l||"transparent",this.opacity=o(100,255*Math.random(),255)}update(){this.velocity.y+=.01,this.pos=this.pos.add(this.velocity),this.opacity-=2}render(){ct.renderer.circle(this.pos.x,this.pos.y,this.radius,{fillStyle:this.color,lineWidth:1,globalAlpha:this.opacity/255})}}class bt{constructor(t,e,i,n){this.pos=e,this.lifeDuration=i,this.particles=[],this.UUID=100*s.randint(1,100);for(let s=0;s<t;s++){let t=new pt(this.UUID+s,this.pos);this.particles.push(t)}new mt(this.lifeDuration,(()=>{this.destroy(),n&&n()}))}addParticles(t){return t.concat(this.particles)}removeParticles(t){const e=this.particles.length;return t.filter((t=>!d(t.id,this.UUID,this.UUID+e)))}destroy(){}}class yt{constructor(t,e){this.rows=e,this.cols=t,this.cells=[],this.focusCell=null,this.createCells(),this.defineNeighboors()}createCells(){for(let t=0;t<this.cols;t++)for(let e=0;e<this.rows;e++)this.cells.push(new Gt(t,e))}updateCell(t){if(this.cells.includes(t)){if(1!==t.width||1!==t.height){if(t.width>1){let e=t.width-1,s=this.cells.filter((s=>s.y===t.y&&s.x>t.x&&s.x<=t.x+e));this.cells=this.cells.filter((t=>!s.includes(t)))}if(t.height>1){let e=t.height-1,s=this.cells.filter((s=>s.x===t.x&&s.y>t.y&&s.y<=t.y+e));this.cells=this.cells.filter((t=>!s.includes(t)))}}this.defineNeighboors(),this.cells[this.cells.indexOf(t)]=t}}defineNeighboors(){this.cells.forEach((t=>{t.neighboors.top=t.y>=1?this.cells.filter((e=>e.x<=t.x&&e.x+e.width>t.x&&e.y===t.y-t.height))[0]:null,t.neighboors.bottom=t.y<=this.rows-1?this.cells.filter((e=>e.x<=t.x&&e.x+e.width>t.x&&e.y===t.y+t.height))[0]:null,t.neighboors.left=t.x>=1?this.cells.filter((e=>e.y<=t.y&&e.y+e.height>t.y&&e.x===t.x-t.width))[0]:null,t.neighboors.right=t.x<=this.cols-1?this.cells.filter((e=>e.y<=t.y&&e.y+e.height>t.y&&e.x===t.x+t.width))[0]:null}))}get(t,e){return this.cells[t*this.cols+e]}clear(){this.cells.forEach((t=>t.state=null))}}class Gt{constructor(t,e,s=1,i=1){this.x=t,this.y=e,this.width=s,this.height=i,this.state=null,this.neighboors={}}}const Zt={},xt={linear:t=>t,smoothStep:t=>(3-2*t)*t**2,smootherStep:t=>(6*t*t-15*t+10)*t**3,easeIn:t=>t**2,easeOut:t=>1-(1-t)**2,easeInOut:t=>t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2,easeInBack:t=>2.70158*t**3-1.70158*t**2,easeOutBack:t=>1+1.70158*Math.pow(t-1,3)+2.70158*Math.pow(t-1,2),easeInOutBack:t=>t<.5?Math.pow(2*t,2)*(7.189819*t-2.5949095)/2:(Math.pow(2*t-2,2)*(3.5949095*(2*t-2)+2.5949095)+2)/2},ft={autostart:!1,loop:!1};class Wt{constructor(e,s,i,n=xt.linear,l={}){if(this.hasStarted=!1,this.isPaused=!1,this.isEnded=!1,this.isReversed=!1,this.lastT=0,this.from=e,this.to=s,this.duration=i,n instanceof Function)this.easing=n;else{if("string"!=typeof n||!(n in xt))throw new I("Unknow easing parameter","animation");this.easing=xt[n]}this.options=t(t({},ft),l),this.value=this.from,this.speed=Math.abs(this.to-this.from)/this.duration,X.add(this)}start(){this.isEnded=!1,this.hasStarted=!0}reset(){this.lastT=0,this.isPaused=!1,this.hasStarted=!1,this.isEnded=!1}toggle(t){void 0!==t&&(t?this.pause():this.resume()),this.isPaused?this.resume():this.pause()}pause(){this.isPaused=!0}resume(){this.isPaused=!1}update(t){if(!this.hasStarted||this.isPaused)return;let e=o(0,this.lastT+t*this.speed/Math.abs(this.to-this.from),1);if(e>=1||e<=0){if(!this.options.loop)return this.isEnded=!0,void this.onFinish();this.speed*=-1,this.isReversed=!this.isReversed}this.lastT=e,this.value=this.from+(this.to-this.from)*this.easing(e)}get isRunning(){return this.hasStarted&&!(this.isEnded||this.isPaused)}onFinish(){}}const Lt=1,gt=!1;class Rt extends Audio{constructor(t,e={}){super(t),this.volume=e.volume||Lt,this.loop=e.loop||gt,this.controls=!1}}const St="0.5.1";export{F as AnimatedSprite,Wt as Animation,f as ApiIsSupported,c as Box,Gt as Cell,Zt as Config,mt as Cooldown,xt as Easing,R as Event,ct as Game,ht as GameEnvironement,rt as GameObject,yt as Grid,Y as Interface,lt as OffscreenRenderer,pt as Particle,bt as ParticuleGenerator,ut as PlayerObject,n as Point,s as Random,q as Renderer,Rt as Sound,z as SpriteSheet,V as Texture,St as VERSION,l as V_NULL,a as V_UNIT,i as Vector2,p as adaptCanvasToDevicePixelRatio,y as blink,o as clamp,m as createCanvas,r as getCanvasDimensions,h as getWindowDimensions,Z as hashObject,d as inRange,b as insertCanvas,G as isWorker,x as now,u as setCanvasDimensions,W as windowIsLoaded};
