var t=Object.assign;var e,i;(i=e||(e={}))[i.KeyboardPressed=0]="KeyboardPressed",i[i.KeyboardDown=1]="KeyboardDown",i[i.Mouse=2]="Mouse",i[i.Window=3]="Window",i[i.Custom=4]="Custom";const s=new class{constructor(){this.windowEvents=[],this.keyboardDownEvents=[],this.keyboardPressedEvents=[],this.customEvents=[],this.currentKeyEvents=[]}init(){window.addEventListener("keydown",(t=>{this.currentKeyEvents.find((e=>e.code===t.code))||this.currentKeyEvents.push(t),this.keyboardPressedEvents.forEach((e=>{t.code===e.name&&e.callback(t)}))})),window.addEventListener("keyup",(t=>{this.currentKeyEvents.length&&(this.currentKeyEvents=this.currentKeyEvents.filter((e=>e.code!==t.code)))}))}addEvent(t){switch(t.type){case e.KeyboardDown:this.keyboardDownEvents.push(t);case e.KeyboardPressed:this.keyboardPressedEvents.push(t);case e.Mouse:break;case e.Window:this.windowEvents.push(t),this.bindEvents();case e.Custom:this.customEvents.push(t)}}getCustomEvent(t){return this.customEvents.find((e=>e.name===t))}bindEvents(){this.windowEvents.forEach((t=>window.addEventListener(t.name,t.callback)))}tick(){this.currentKeyEvents.length&&this.keyboardDownEvents.forEach((t=>{this.currentKeyEvents.forEach((e=>{e.code===t.name&&t.callback(e)}))}))}};"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var n,r=(function(t,e){var i;t.exports=((i=function(){function t(t){return n.appendChild(t.dom),t}function e(t){for(var e=0;e<n.children.length;e++)n.children[e].style.display=e===t?"block":"none";s=t}var s=0,n=document.createElement("div");n.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",n.addEventListener("click",(function(t){t.preventDefault(),e(++s%n.children.length)}),!1);var r=(performance||Date).now(),o=r,a=0,c=t(new i.Panel("FPS","#0ff","#002")),l=t(new i.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var h=t(new i.Panel("MB","#f08","#201"));return e(0),{REVISION:16,dom:n,addPanel:t,showPanel:e,begin:function(){r=(performance||Date).now()},end:function(){a++;var t=(performance||Date).now();if(l.update(t-r,200),t>o+1e3&&(c.update(1e3*a/(t-o),100),o=t,a=0,h)){var e=performance.memory;h.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){r=this.end()},domElement:n,setMode:e}}).Panel=function(t,e,i){var s=1/0,n=0,r=Math.round,o=r(window.devicePixelRatio||1),a=80*o,c=48*o,l=3*o,h=2*o,d=3*o,u=15*o,p=74*o,y=30*o,f=document.createElement("canvas");f.width=a,f.height=c,f.style.cssText="width:80px;height:48px";var m=f.getContext("2d");return m.font="bold "+9*o+"px Helvetica,Arial,sans-serif",m.textBaseline="top",m.fillStyle=i,m.fillRect(0,0,a,c),m.fillStyle=e,m.fillText(t,l,h),m.fillRect(d,u,p,y),m.fillStyle=i,m.globalAlpha=.9,m.fillRect(d,u,p,y),{dom:f,update:function(c,w){s=Math.min(s,c),n=Math.max(n,c),m.fillStyle=i,m.globalAlpha=1,m.fillRect(0,0,a,u),m.fillStyle=e,m.fillText(r(c)+" "+t+" ("+r(s)+"-"+r(n)+")",l,h),m.drawImage(f,d+o,u,p-o,y,d,u,p-o,y),m.fillRect(d+p-o,u,o,y),m.fillStyle=i,m.globalAlpha=.9,m.fillRect(d+p-o,u,o,r((1-c/w)*y))}}},i)}(n={exports:{}},n.exports),n.exports);let o="normal";class a{constructor(t,e){this.name=t,this.env=e,this.stats=null}static setRendererType(t){o=t}static get rendererType(){return o}setMainLoop(t){this.gameLoop=t}update(t){this.stats.begin(),s.tick(),this.gameLoop(t),this.stats.end(),window.requestAnimationFrame((t=>this.update(t)))}start(){if(!this.gameLoop)throw new Error("No game loop");window.addEventListener("DOMContentLoaded",(()=>{this.name&&(document.title=this.name),s.init(),class{static init(t){this.items=[]}static addItem(t,e){}}.init(this),this.stats=function(){const t=new r,e=document.createElement("div");return e.classList.toggle("stats"),t.showPanel(0),e.appendChild(t.dom),document.body.appendChild(e),t}(),this.update(0)}))}}class c{constructor(t,e){this.width=t,this.height=e}update(){}render(){}}class l{constructor(t,e){this.x=t,this.y=e}collide(t){return!!(t.width&&t.height&&this.width&&this.height)&&(this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.height+this.y>t.y)}update(...t){}render(t,...e){}}class h extends l{constructor(t,e){super(t,e)}update(...t){}render(t,...e){}}function d(){return{width:window.innerWidth,height:window.innerHeight}}function u(t,e,i,s){const n=i||window.devicePixelRatio||1,r=document.createElement("canvas");return 1!=n&&(r.width=t*n,r.height=e*n,r.style.width=t+"px",r.style.height=e+"px",r.getContext("2d").setTransform(n,0,0,n,0,0)),s&&(r.oncontextmenu=t=>t.preventDefault()),r}function p(t,e){window.onload=()=>{let i=document.querySelector(e);i||(i=document.createElement(e)),i.appendChild(t),document.querySelector("body").appendChild(i)}}class y{static random(){return Math.random()}static randint(t,e){return Math.floor(t+Math.random()*(e-t))}static choice(t){return t[~~(y.random()*t.length)]}static bool(){return y.random()>.5}static percent(t){return y.random()<t/100}}var f=y;class m{constructor(t,e){this.x=t,this.y=e}add(t){return new m(this.x+t.x,this.y+t.y)}clone(){return new m(this.x,this.y)}dist(t){return Math.sqrt((this.x-t.x)**2+(this.y-t.y)**2)}}function w(t,e,i){return Math.max(t,Math.min(e,i))}class v{constructor(t,e){this.delay=t,this.callback=e,window.setTimeout(this.callback,this.delay)}}const g={strokeStyle:"black",lineWidth:2,lineJoin:"round",fillStyle:"transparent",globalAlpha:1,globalCompositeOperation:"add"};let x=4;try{x=2*(window.devicePixelRatio||1)}catch(L){}function b(t){return~~(t*x)/x}let E=null;class k{static create(t,e){const i=u(t,e);return p(i,"main"),k.setContext(i.getContext("2d")),i}static setContext(t){E=t}static style(e){if(!E)throw new Error("Context has not been initialize. Please use Renderer.setContext");const i=t(t({},g),e);for(let t in i)E[t]!==i[t]&&(E[t]=i[t])}static clear(t){t?(k.style({fillStyle:t}),E.fillRect(0,0,E.canvas.width,E.canvas.height)):E.clearRect(0,0,E.canvas.width,E.canvas.height)}static line(t,e,i){k.style(i),E.beginPath(),E.moveTo(b(t.x),b(t.y)),E.lineTo(b(e.x),b(e.y)),E.stroke()}static rect(t,e,i,s,n,r){r||k.style(n);const[o,a,c,l]=[b(t),b(e),b(i),b(s)];E.fillRect(o,a,c,l),E.strokeRect(o,a,c,l)}static poly(t,e){if(t.length){k.style(e),E.beginPath(),E.moveTo(b(t[0].x),b(t[0].y));for(let e=1;e<t.length;e++)E.lineTo(b(t[e].x),b(t[e].y));E.stroke()}}static circle(t,e,i,s){k.style(s),E.beginPath(),E.arc(b(t),b(e),i,0,2*Math.PI),E.stroke()}static point(t,e,i){k.circle(t,e,5,i)}static rectSprite(t,e,i,s,n){k.style({}),E.save(),E.translate(b(t+i/2),b(e+s/2)),E.scale(n.scale.x,n.scale.y),E.rotate(n.rotation),E.drawImage(n.image,b(i*n.offset.x-i/2),b(s*n.offset.y-s/2),b(i),b(s)),E.restore()}static circleSprite(t,e,i,s){E.save(),E.beginPath(),E.arc(b(t),b(e),i,0,2*Math.PI),E.clip(),k.rectSprite(t-i,e-i,2*i,2*i,s),E.restore()}static tint(t,e,i,s,n){k.rect(e,i,s,n,{fillStyle:t,globalCompositeOperation:"multiply",globalAlpha:.25})}}class P{constructor(t,e){this.title=t,this.content=e}}let M=null,S=null;function C(t,e,i){S.postMessage(new P(t,e),i||[])}function R(t,e){C("render",{method:t,args:e})}class T{static create(t,e){const i=u(t,e,1);return T.transferTo(i,t,e),p(i,"main"),i}static transferTo(t,e,i){M=t.transferControlToOffscreen();let{clientWidth:s,clientHeight:n}=t;"offscreen"!==a.rendererType&&a.setRendererType("offscreen"),T.initRenderWorker(e||s,i||n)}static initRenderWorker(t,e){S=new Worker("./src/render/offscreen/renderer-worker.ts",{type:"module"}),C("initCanvas",{canvas:M,width:t,height:e,dpr:window.devicePixelRatio||1},[M]),S.onmessage=t=>{console.log("message from the worker : ",t.data)}}static style(t){R("style",t)}static clear(t){R("clear",t)}static line(t,e,i){R("line",{point1:t,point2:e,obj:i})}static rect(t,e,i,s,n,r){R("rect",{x:t,y:e,width:i,height:s,obj:n,noStyle:r})}static poly(t,e){R("poly",{points:t,obj:e})}static circle(t,e,i,s){R("circle",{x:t,y:e,radius:i,obj:s})}static point(t,e,i){R("point",{x:t,y:e,obj:i})}static rectSprite(t,e,i,s,n){R("rectSprite",{x:t,y:e,width:i,height:s,texture:n})}static circleSprite(t,e,i,s){R("circleSprite",{x:t,y:e,radius:i,texture:s})}static tint(t,e,i,s,n){R("circle",{color:t,x:e,y:i,width:s,height:n})}}class D extends l{constructor(t,e,i=5,s,n){super(e.x,e.y),this.id=t,this.pos=e.clone(),this.angle=s&&"random"!=s?s%2*Math.PI:Math.PI/2+2*Math.random()*Math.PI,this.velocity=new m(Math.random()*i*Math.cos(this.angle),Math.random()*i*Math.sin(this.angle)),this.color=n||"red",this.opacity=w(100,255*Math.random(),255),this.radius=2}update(){this.velocity.y+=.01,this.pos=this.pos.add(this.velocity),this.opacity--}render(){switch(a.rendererType){case"normal":k.circle(this.pos.x,this.pos.y,this.radius,{fillStyle:this.color,lineWidth:1,globalAlpha:this.opacity/255});break;case"offscreen":T.circle(this.pos.x,this.pos.y,this.radius,{fillStyle:this.color,lineWidth:1,globalAlpha:this.opacity/255})}}}class I{constructor(t,e,i,s){this.pos=e,this.lifeDuration=i,this.particles=[],this.UUID=100*f.randint(1,100);for(let n=0;n<t;n++){let t=new D(this.UUID+n,this.pos);this.particles.push(t)}new v(this.lifeDuration,(()=>{this.destroy(),s()}))}addParticles(t){return t.concat(this.particles)}removeParticles(t){const e=this.particles.length;return t.filter((t=>{return i=t.id,s=this.UUID,n=this.UUID+e,!(w(s,i,n)===i);var i,s,n}))}destroy(){}}const K="0.0.5";export{a as Game,c as GameEnvironement,l as GameObject,D as Particle,I as ParticuleGenerator,h as PlayerObject,K as VERSION,u as createCanvas,d as getWindowDimensions};
