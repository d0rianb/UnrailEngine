var t=Object.defineProperty,e=Object.prototype.hasOwnProperty,i=Object.getOwnPropertySymbols,n=Object.prototype.propertyIsEnumerable,s=(e,i,n)=>i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[i]=n,o=(t,o)=>{for(var r in o||(o={}))e.call(o,r)&&s(t,r,o[r]);if(i)for(var r of i(o))n.call(o,r)&&s(t,r,o[r]);return t};var r,a;(a=r||(r={}))[a.KeyboardPressed=0]="KeyboardPressed",a[a.KeyboardDown=1]="KeyboardDown",a[a.Mouse=2]="Mouse",a[a.Window=3]="Window",a[a.Custom=4]="Custom";const c=new class{constructor(){this.windowEvents=[],this.keyboardDownEvents=[],this.keyboardPressedEvents=[],this.customEvents=[],this.currentKeyEvents=[]}init(){window.addEventListener("keydown",(t=>{this.currentKeyEvents.find((e=>e.code===t.code))||this.currentKeyEvents.push(t),this.keyboardPressedEvents.forEach((e=>{t.code===e.name&&e.callback(t)}))})),window.addEventListener("keyup",(t=>{this.currentKeyEvents.length&&(this.currentKeyEvents=this.currentKeyEvents.filter((e=>e.code!==t.code)))}))}addEvent(t){switch(t.type){case r.KeyboardDown:this.keyboardDownEvents.push(t);case r.KeyboardPressed:this.keyboardPressedEvents.push(t);case r.Mouse:break;case r.Window:this.windowEvents.push(t),this.bindEvents();case r.Custom:this.customEvents.push(t)}}getCustomEvent(t){return this.customEvents.find((e=>e.name===t))}bindEvents(){this.windowEvents.forEach((t=>window.addEventListener(t.name,t.callback)))}tick(){this.currentKeyEvents.length&&this.keyboardDownEvents.forEach((t=>{this.currentKeyEvents.forEach((e=>{e.code===t.name&&t.callback(e)}))}))}};"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var l,d=(function(t,e){var i;t.exports=((i=function(){function t(t){return s.appendChild(t.dom),t}function e(t){for(var e=0;e<s.children.length;e++)s.children[e].style.display=e===t?"block":"none";n=t}var n=0,s=document.createElement("div");s.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",s.addEventListener("click",(function(t){t.preventDefault(),e(++n%s.children.length)}),!1);var o=(performance||Date).now(),r=o,a=0,c=t(new i.Panel("FPS","#0ff","#002")),l=t(new i.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var d=t(new i.Panel("MB","#f08","#201"));return e(0),{REVISION:16,dom:s,addPanel:t,showPanel:e,begin:function(){o=(performance||Date).now()},end:function(){a++;var t=(performance||Date).now();if(l.update(t-o,200),t>r+1e3&&(c.update(1e3*a/(t-r),100),r=t,a=0,d)){var e=performance.memory;d.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){o=this.end()},domElement:s,setMode:e}}).Panel=function(t,e,i){var n=1/0,s=0,o=Math.round,r=o(window.devicePixelRatio||1),a=80*r,c=48*r,l=3*r,d=2*r,h=3*r,u=15*r,p=74*r,y=30*r,f=document.createElement("canvas");f.width=a,f.height=c,f.style.cssText="width:80px;height:48px";var m=f.getContext("2d");return m.font="bold "+9*r+"px Helvetica,Arial,sans-serif",m.textBaseline="top",m.fillStyle=i,m.fillRect(0,0,a,c),m.fillStyle=e,m.fillText(t,l,d),m.fillRect(h,u,p,y),m.fillStyle=i,m.globalAlpha=.9,m.fillRect(h,u,p,y),{dom:f,update:function(c,w){n=Math.min(n,c),s=Math.max(s,c),m.fillStyle=i,m.globalAlpha=1,m.fillRect(0,0,a,u),m.fillStyle=e,m.fillText(o(c)+" "+t+" ("+o(n)+"-"+o(s)+")",l,d),m.drawImage(f,h+r,u,p-r,y,h,u,p-r,y),m.fillRect(h+p-r,u,r,y),m.fillStyle=i,m.globalAlpha=.9,m.fillRect(h+p-r,u,r,o((1-c/w)*y))}}},i)}(l={exports:{}},l.exports),l.exports);function h(){return{width:window.innerWidth,height:window.innerHeight}}function u(t,e,i,n){const s=i||window.devicePixelRatio||1,o=document.createElement("canvas");return 1!=s&&(o.width=t*s,o.height=e*s,o.style.width=t+"px",o.style.height=e+"px",o.getContext("2d").setTransform(s,0,0,s,0,0)),n&&(o.oncontextmenu=t=>t.preventDefault()),o}function p(t,e){window.onload=()=>{let i=document.querySelector(e);i||(i=document.createElement(e)),i.appendChild(t),document.querySelector("body").appendChild(i)}}const y={strokeStyle:"black",lineWidth:2,lineJoin:"round",fillStyle:"transparent",globalAlpha:1,globalCompositeOperation:"add"};let f=4;try{f=2*(window.devicePixelRatio||1)}catch(Q){}function m(t){return~~(t*f)/f}let w=null;class v{static create(t,e){const i=u(t,e);return p(i,"main"),v.setContext(i.getContext("2d")),i}static setContext(t){w=t}static getContext(){return w}static style(t){if(!w)throw new Error("Context has not been initialize. Please use Renderer.setContext");const e=o(o({},y),t);for(let i in e)w[i]!==e[i]&&(w[i]=e[i])}static clear(t){t?(v.style({fillStyle:t}),w.fillRect(0,0,w.canvas.width,w.canvas.height)):w.clearRect(0,0,w.canvas.width,w.canvas.height)}static line(t,e,i){v.style(i),w.beginPath(),w.moveTo(m(t.x),m(t.y)),w.lineTo(m(e.x),m(e.y)),w.stroke()}static rect(t,e,i,n,s,o){o||v.style(s);const[r,a,c,l]=[m(t),m(e),m(i),m(n)];w.fillRect(r,a,c,l),w.strokeRect(r,a,c,l)}static poly(t,e){if(t.length){v.style(e),w.beginPath(),w.moveTo(m(t[0].x),m(t[0].y));for(let e=1;e<t.length;e++)w.lineTo(m(t[e].x),m(t[e].y));w.stroke()}}static circle(t,e,i,n){v.style(n),w.beginPath(),w.arc(m(t),m(e),i,0,2*Math.PI),w.stroke()}static point(t,e,i){v.circle(t,e,5,i)}static rectSprite(t,e,i,n,s){v.style({}),w.save(),w.translate(m(t+i/2),m(e+n/2)),w.scale(s.scale.x,s.scale.y),w.rotate(s.rotation),w.drawImage(s.image,m(i*s.offset.x-i/2),m(n*s.offset.y-n/2),m(i),m(n)),w.restore()}static circleSprite(t,e,i,n){w.save(),w.beginPath(),w.arc(m(t),m(e),i,0,2*Math.PI),w.clip(),v.rectSprite(t-i,e-i,2*i,2*i,n),w.restore()}static tint(t,e,i,n,s){v.rect(e,i,n,s,{fillStyle:t,globalCompositeOperation:"multiply",globalAlpha:.25})}}class g{constructor(t,e){this.title=t,this.content=e}}let x=null,b=null,E=null;const S=new Map;function P(t,e,i){b.postMessage(new g(t,e),i||[])}function k(t,e){P("render",{method:t,args:e})}class M{static create(t,e){return E=u(t,e,1),M.transferTo(E,t,e),p(E,"main"),E}static transferTo(t,e,i){x=t.transferControlToOffscreen();let{clientWidth:n,clientHeight:s}=t;"offscreen"!==z.rendererType&&z.setRendererType("offscreen"),M.initRenderWorker(e||n,i||s)}static initRenderWorker(t,e){b=new Worker("./src/render/offscreen-renderer/renderer-worker.ts",{type:"module"}),P("initCanvas",{canvas:x,width:t,height:e,dpr:window.devicePixelRatio||1},[x]),b.onmessage=t=>{console.log("message from the worker : ",t.data)}}static style(t){k("style",t)}static clear(t){k("clear",t)}static line(t,e,i){k("line",{point1:t,point2:e,obj:i})}static rect(t,e,i,n,s,o){k("rect",{x:t,y:e,width:i,height:n,obj:s,noStyle:o})}static poly(t,e){k("poly",{points:t,obj:e})}static circle(t,e,i,n){k("circle",{x:t,y:e,radius:i,obj:n})}static point(t,e,i){k("point",{x:t,y:e,obj:i})}static async rectSprite(t,e,i,n,s){if(s.id in S)k("rectSprite",{x:t,y:e,width:i,height:n,texture:S[s.id]});else{const o=await s.convertToBitmap();S[s.id]=o,k("rectSprite",{x:t,y:e,width:i,height:n,texture:o})}}static async circleSprite(t,e,i,n){if(n.id in S)k("circleSprite",{x:t,y:e,radius:i,texture:S[n.id]});else{const s=await n.convertToBitmap();S[n.id]=s,k("circleSprite",{x:t,y:e,radius:i,texture:s})}}static tint(t,e,i,n,s){k("circle",{color:t,x:e,y:i,width:n,height:s})}}class T{static random(){return Math.random()}static randint(t,e){return Math.floor(t+Math.random()*(e-t))}static choice(t){return t[~~(T.random()*t.length)]}static bool(){return T.random()>.5}static sign(){return T.choice([-1,1])}static percent(t){return T.random()<t/100}}var C=T;class R{constructor(t,e){this.x=t,this.y=e}add(t){return new R(this.x+t.x,this.y+t.y)}clone(){return new R(this.x,this.y)}dist(t){return Math.sqrt((this.x-t.x)**2+(this.y-t.y)**2)}}const D=R,I=new R(0,0),L=new R(1,1);function K(t,e,i){return Math.max(t,Math.min(e,i))}function O(t,e,i){return K(e,t,i)===t}let j=[],W=4;const q=["top-left","top-right","bottom-left","bottom-right","custom"];class A{static addItem(t,e,i){const n={callback:t,position:e,options:i};j.push(n);const s=j.length;window.addEventListener("load",(()=>A.addToDom(n,s)))}static init(){const t=document.createElement("div");t.classList.add("ue-interface","ue-container");for(let e of q){const i=document.createElement("div");i.classList.add(e),t.appendChild(i)}document.body.appendChild(t)}static addToDom(t,e){var i,n;const s=t.callback(),o=document.createElement("span");o.classList.add("ue-interface-items"),o.id=`item-${e}`,o.innerText=s,Object.entries(t.options||{}).forEach((([t,e])=>o.style[t]=e)),t.position?null==(i=document.querySelector(`.ue-container > .${t.position}`))||i.appendChild(o):null==(n=document.querySelector(".ue-container > .custom"))||n.appendChild(o)}static update(){j.forEach(((t,e)=>{const i=t.callback(),n=document.querySelector(`.ue-interface #item-${e+1}`);n&&n.innerText!==i&&(n.innerText=i)}))}static statsShift(t){const e=document.querySelector(".top-left");e&&(e.style.top=`${t}px`)}static setUpdateInterval(t){W=t}static get updateInterval(){return W}}function U(){const t=new d,e=document.createElement("div");return e.classList.toggle("stats"),t.showPanel(0),e.appendChild(t.dom),document.body.appendChild(e),A.statsShift(48),t}let H="normal";class z{constructor(t,e){this.name=t,this.env=e,this.tick=0,this.stats=null,this.showStatsPanel=!0}static setRendererType(t){H=t}static get rendererType(){return H}toggleStats(t){this.showStatsPanel=void 0!==t?t:!this.showStatsPanel,this.showStatsPanel?this.stats=U():(this.stats=null,document.querySelector(".stats")&&document.querySelector(".stats").remove())}setMainLoop(t){this.gameLoop=t}update(t){var e,i;null==(e=this.stats)||e.begin(),c.tick(),this.gameLoop(t),this.tick%A.updateInterval==0&&A.update(),null==(i=this.stats)||i.end(),window.requestAnimationFrame((t=>this.update(t)))}start(){if(!this.gameLoop)throw new Error("No game loop");window.addEventListener("DOMContentLoaded",(()=>{this.name&&(document.title=this.name),c.init(),A.init(),this.showStatsPanel&&(this.stats=U()),this.update(0)}))}}class B{constructor(t,e){this.width=t,this.height=e}update(){}render(){}}class ${constructor(t,e){this.x=t,this.y=e}collide(t){return!!(t.width&&t.height&&this.width&&this.height)&&(this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.height+this.y>t.y)}update(...t){}render(t,...e){}}class F extends ${constructor(t,e){super(t,e)}update(...t){}render(t,...e){}}class J{constructor(t,e){this.delay=t,this.callback=e,window.setTimeout(this.callback,this.delay)}}class N extends ${constructor(t,e,i=5,n,s){super(e.x,e.y),this.id=t,this.pos=e.clone(),this.angle=n&&"random"!=n?n%2*Math.PI:Math.PI/2+2*Math.random()*Math.PI,this.velocity=new R(Math.random()*i*Math.cos(this.angle),Math.random()*i*Math.sin(this.angle)),this.color=s||"red",this.opacity=K(100,255*Math.random(),255),this.radius=2}update(){this.velocity.y+=.01,this.pos=this.pos.add(this.velocity),this.opacity--}render(){switch(z.rendererType){case"normal":v.circle(this.pos.x,this.pos.y,this.radius,{fillStyle:this.color,lineWidth:1,globalAlpha:this.opacity/255});break;case"offscreen":M.circle(this.pos.x,this.pos.y,this.radius,{fillStyle:this.color,lineWidth:1,globalAlpha:this.opacity/255})}}}class G{constructor(t,e,i,n){this.pos=e,this.lifeDuration=i,this.particles=[],this.UUID=100*C.randint(1,100);for(let s=0;s<t;s++){let t=new N(this.UUID+s,this.pos);this.particles.push(t)}new J(this.lifeDuration,(()=>{this.destroy(),n()}))}addParticles(t){return t.concat(this.particles)}removeParticles(t){const e=this.particles.length;return t.filter((t=>!O(t.id,this.UUID,this.UUID+e)))}destroy(){}}const V="0.1.0";export{z as Game,B as GameEnvironement,$ as GameObject,N as Particle,G as ParticuleGenerator,F as PlayerObject,D as Point,C as Random,V as VERSION,I as V_NULL,L as V_UNIT,R as Vector2,K as clamp,u as createCanvas,h as getWindowDimensions,O as inRange};
